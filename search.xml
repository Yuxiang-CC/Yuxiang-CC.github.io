<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>git简介与命令使用</title>
      <link href="2020/11/02/Git%E7%AE%80%E4%BB%8B%E4%B8%8E%E5%91%BD%E4%BB%A4%E4%BD%BF%E7%94%A8/"/>
      <url>2020/11/02/Git%E7%AE%80%E4%BB%8B%E4%B8%8E%E5%91%BD%E4%BB%A4%E4%BD%BF%E7%94%A8/</url>
      
        <content type="html"><![CDATA[<p>Git入门和常用命令操作</p><a id="more"></a><h2 id="git命令"><a href="#git命令" class="headerlink" title="git命令"></a>git命令</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 比较文件不同</span></span><br><span class="line">git diff HEAD</span><br><span class="line"><span class="meta">#</span><span class="bash"> 工作区与本地仓库比较不同</span></span><br><span class="line">git diff --cached</span><br><span class="line"><span class="meta">#</span><span class="bash"> 工作区与缓存区比较不同</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 从缓存区中删除文件 但 不删除工作区中文件</span></span><br><span class="line">git reset HEAD -- [文件名]</span><br><span class="line">git rm --cached [文件名]</span><br><span class="line"><span class="meta">#</span><span class="bash"> 从缓存区中删除文件 并且 删除工作区中的文件</span></span><br><span class="line">git rm [文件名]</span><br><span class="line"><span class="meta">#</span><span class="bash"> 将缓存区中的文件重命名并重新添加到缓存区</span></span><br><span class="line">git mv [原文件名] [更改后文件名]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 创建分支</span></span><br><span class="line">git branch [分支名]  # // 如果分支名不写则列出所有分支</span><br><span class="line"><span class="meta">#</span><span class="bash"> 切换分支</span></span><br><span class="line">git checkout [分支名]</span><br><span class="line"><span class="meta">#</span><span class="bash"> 删除分支</span></span><br><span class="line">git checkout -d [分支名]</span><br><span class="line"><span class="meta">#</span><span class="bash"> 将指定分支 与 当前分支合并，当出现冲突时需要自己解决冲突后，commit来完成 merge操作</span></span><br><span class="line">git merge [分支名] </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 查看历史版本</span></span><br><span class="line">git log </span><br><span class="line">git log --oneline # 仅仅一行显示</span><br><span class="line">git log --graph # 查看历史中什么时候出现了分支、合并。</span><br><span class="line">git log --reverse # 逆向查看历史中什么时候出现分支、合并。</span><br><span class="line">git log --author=[作者]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">git 标签</span><br><span class="line">git tag  # 查看所有标签</span><br><span class="line"><span class="meta">#</span><span class="bash"> git tag 默认为当前HEAD指向的版本添加标签 ，可以添加之前版本的hansh值来为之前的版本添加<span class="built_in">hash</span>值</span></span><br><span class="line">git tag -a [标签名] -m [&#x27;描述信息&#x27;]  [之前版本的hash值]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 添加远程库</span></span><br><span class="line">git remote add [远程仓库别名] [url]</span><br><span class="line"><span class="meta">#</span><span class="bash"> 查看当前远程库</span></span><br><span class="line">git remote</span><br><span class="line">git remote -v</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 提取远程仓库</span></span><br><span class="line">git fetch  # 该命令执行完后需要执行git merge 远程分支到你所在的分支。</span><br><span class="line">git pull # 从远端仓库提取数据并尝试合并到当前分支</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 推送到远程仓库</span></span><br><span class="line">git push [远程仓库别名] [branch]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 删除远程仓库</span></span><br><span class="line">git remote rm [别名]</span><br></pre></td></tr></table></figure><h2 id="github搜索"><a href="#github搜索" class="headerlink" title="github搜索"></a>github搜索</h2><blockquote><ol><li><p>按名字搜索</p><p>in:name [spring boot]</p></li><li><p>按star搜索</p><p>in:name [spring boot/spring] stars:&gt;数量(300)</p></li><li><p>按fork数搜索</p><p>in:name [spring boot/spring] stars:&gt;数量(300) forks:&gt;数量</p></li><li><p>按readme搜索</p><p>in:readme [spring boot] [stars:&gt;数量(300)] [forks:&gt;数量]</p></li><li><p>按描述搜索</p><p>in:description [spring cloud] [language:java] [上传时间 pushd:&gt;日期]</p><p>in:description [爬虫] language:python stars:&gt;200</p></li></ol><p> 明确搜索某个人或组织的仓库</p><p>   user:userName</p><p>   user:userName language:java</p><p>   org:spring-cloud</p></blockquote>]]></content>
      
      
      <categories>
          
          <category> git </category>
          
      </categories>
      
      
        <tags>
            
            <tag> git </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>PolarDB和ECS搭建门户网站</title>
      <link href="2020/11/02/PolarDB%E5%92%8CECS%E6%90%AD%E5%BB%BA%E9%97%A8%E6%88%B7%E7%BD%91%E7%AB%99/"/>
      <url>2020/11/02/PolarDB%E5%92%8CECS%E6%90%AD%E5%BB%BA%E9%97%A8%E6%88%B7%E7%BD%91%E7%AB%99/</url>
      
        <content type="html"><![CDATA[<p>使用PolarDB和ECS搭建门户网站</p><a id="more"></a><h2 id="PolarDB简介"><a href="#PolarDB简介" class="headerlink" title="PolarDB简介"></a>PolarDB简介</h2><p>PolarDB是阿里云自研的下一代关系型云数据库，有三个独立的引擎，分别可以100%兼容MySQL、100%兼容PostgreSQL、高度兼容Oracle语法，存储容量最高可达100TB，单库最多可扩展到16个节点，适用于企业多样化的数据库应用场景。</p><p>PolarDB采用存储和计算分离的架构，所有计算节点共享一份数据，提供分钟级的配置升降级、秒级的故障恢复、全局数据一致性和免费的数据备份容灾服务。PolarDB既融合了商业数据库稳定可靠、高性能、可扩展的特征，又具有开源云数据库简单开放、自我迭代的优势，例如PolarDB MySQL性能最高可以提升至MySQL的6倍，而成本只有商用数据库的1/10。集群架构，计算与存储分离。</p><h2 id="开通、连接资源"><a href="#开通、连接资源" class="headerlink" title="开通、连接资源"></a>开通、连接资源</h2><p><a href="https://developer.aliyun.com/adc/scenario/a7161434e6cd499e9e26f2e62d0242fb">PolarDB</a>免费上手体验。</p><ol><li>单击<strong>免费开通</strong>创建所需资源。</li></ol><p><img src="001.png" class="lazyload placeholder" data-srcset="001.png" srcset="https://cdn.jsdelivr.net/gh/volantis-x/cdn-volantis@3/img/placeholder/c617bfd2497fcea598e621413e315c368f8d8e.svg" alt="开通资源"></p><ol start="2"><li>连接服务器。使用<code>CMD</code>、<code>Powershell</code>、<code>Xshell</code>等工具都可以。</li></ol><p><img src="002.png" class="lazyload placeholder" data-srcset="002.png" srcset="https://cdn.jsdelivr.net/gh/volantis-x/cdn-volantis@3/img/placeholder/c617bfd2497fcea598e621413e315c368f8d8e.svg" alt="连接资源"></p><h2 id="创建PolarDB数据库账号"><a href="#创建PolarDB数据库账号" class="headerlink" title="创建PolarDB数据库账号"></a>创建PolarDB数据库账号</h2><ol><li>单击页面左侧<strong>云产品资源</strong>下的一键复制登录url 。</li><li>在浏览器中打开，使用<strong>RAM用户</strong> 登录。</li><li>在 <strong>阿里云控制台首页</strong> 左侧导航栏，依次单击 <strong>产品与服务</strong> &gt; <strong>云数据库PolarDB</strong> ，进入 <strong>云数据库PolarDB管理控制台</strong> 。</li></ol><p><img src="003.png" class="lazyload placeholder" data-srcset="003.png" srcset="https://cdn.jsdelivr.net/gh/volantis-x/cdn-volantis@3/img/placeholder/c617bfd2497fcea598e621413e315c368f8d8e.svg" alt="选择PolarDB"></p><ol start="4"><li>单击左侧 <strong>集群列表</strong> ，然后选择云产品资源提供的地域。</li></ol><p><img src="004.png" class="lazyload placeholder" data-srcset="004.png" srcset="https://cdn.jsdelivr.net/gh/volantis-x/cdn-volantis@3/img/placeholder/c617bfd2497fcea598e621413e315c368f8d8e.svg" alt="选择地区"></p><ol start="5"><li>创建数据库账号。</li></ol><p>1）、 在 <strong>集群列表</strong> 页面，单击 <strong>集群ID</strong> ，进入 <strong>集群详情界面</strong> 。</p><p>2）、单击左侧导航栏 <strong>配置与管理</strong> &gt; <strong>账号管理</strong> 。</p><p>3）、单击左上方 <strong>创建账号</strong> 。</p><p>4）、设置账号密码，然后单击 <strong>确定</strong> 。</p><p><img src="005.png" class="lazyload placeholder" data-srcset="005.png" srcset="https://cdn.jsdelivr.net/gh/volantis-x/cdn-volantis@3/img/placeholder/c617bfd2497fcea598e621413e315c368f8d8e.svg" alt="创建数据库账号"></p><p><img src="006.png" class="lazyload placeholder" data-srcset="006.png" srcset="https://cdn.jsdelivr.net/gh/volantis-x/cdn-volantis@3/img/placeholder/c617bfd2497fcea598e621413e315c368f8d8e.svg" alt="创建数据库账号"></p><ol start="6"><li>创建数据库。</li></ol><p>1）、在实例详情页，单击左侧导航栏的 <strong>数据库管理</strong> ，然后单击 <strong>创建数据库</strong> 。</p><p>2）、参考说明配置数据库信息，然后单击 <strong>创建</strong> 。</p><p><img src="007.png" class="lazyload placeholder" data-srcset="007.png" srcset="https://cdn.jsdelivr.net/gh/volantis-x/cdn-volantis@3/img/placeholder/c617bfd2497fcea598e621413e315c368f8d8e.svg" alt="创建数据库"></p><ol start="7"><li>配置访问白名单。</li></ol><p><img src="008.png" class="lazyload placeholder" data-srcset="008.png" srcset="https://cdn.jsdelivr.net/gh/volantis-x/cdn-volantis@3/img/placeholder/c617bfd2497fcea598e621413e315c368f8d8e.svg" alt="白名单"></p><h2 id="安装环境"><a href="#安装环境" class="headerlink" title="安装环境"></a>安装环境</h2><p>安装Apache、MySQL和PHP的环境。</p><ol><li>安装Apache服务及其扩展包。</li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum -y install httpd httpd-manual mod_ssl mod_perl mod_auth_mysql</span><br></pre></td></tr></table></figure><ol start="2"><li>安装PHP环境。</li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum -y install php php-mysql gd php-gd gd-devel php-xml php-common php-mbstring php-ldap php-pear php-xmlrpc php-imap</span><br></pre></td></tr></table></figure><ol start="3"><li>下载并安装MySQL。</li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">wget http://dev.mysql.com/get/mysql57-community-release-el7-10.noarch.rpm</span><br><span class="line">yum -y install mysql57-community-release-el7-10.noarch.rpm</span><br><span class="line">yum -y install mysql-community-server</span><br></pre></td></tr></table></figure><ol start="4"><li>启动MySQL数据库。</li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">systemctl start mysqld</span><br><span class="line">systemctl status mysqld</span><br></pre></td></tr></table></figure><p><img src="009.png" class="lazyload placeholder" data-srcset="009.png" srcset="https://cdn.jsdelivr.net/gh/volantis-x/cdn-volantis@3/img/placeholder/c617bfd2497fcea598e621413e315c368f8d8e.svg" alt="启动Mysql"></p><h2 id="搭建门户网站"><a href="#搭建门户网站" class="headerlink" title="搭建门户网站"></a>搭建门户网站</h2><ol><li>安装git。</li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install git -y</span><br></pre></td></tr></table></figure><ol start="2"><li>下载PbootCMS源码文件。</li></ol><blockquote><p><strong>PbootCMS</strong>是全新内核且永久开源免费的PHP企业网站开发建设管理系统，是一套高效、简洁、 强悍的可免费商用的PHP CMS源码，能够满足各类企业网站开发建设的需要。系统采用简单到想哭的模板标签，只要懂HTML就可快速开发企业网站。</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cd ~ &amp;&amp; git clone https://gitee.com/hnaoyun/PbootCMS.git</span><br></pre></td></tr></table></figure><ol start="3"><li>将安装包拷贝到Apache的wwwroot目录下。</li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cp -r PbootCMS/* /var/www/html/</span><br></pre></td></tr></table></figure><ol start="4"><li>修改站点根目录文件权限。</li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">chmod -R a+w /var/www/html</span><br></pre></td></tr></table></figure><ol start="5"><li>向数据库中导入CMS的初始数据。</li></ol><p>1）、获取sql文件。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sql_file=&quot;/var/www/html/static/backup/sql/&quot;$(ls /var/www/html/static/backup/sql/) &amp;&amp; echo $sql_file</span><br></pre></td></tr></table></figure><p>2）、连接数据库，并导入CMS的初始数据。</p><blockquote><p><code>数据库连接地址</code>：在开通资源左侧处</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">mysql -h&lt;数据库连接地址&gt; -u&lt;用户名&gt; -p&lt;密码&gt;</span><br><span class="line"></span><br><span class="line">sql_file=&quot;/var/www/html/static/backup/sql/&quot;$(ls /var/www/html/static/backup/sql/) &amp;&amp;</span><br><span class="line">mysql -hpc-uf606ov9nvsq2sh62.mysql.polardb.rds.aliyuncs.com -uyuxiang_test -pYuxiang123 -Dpbootcms &lt; $sql_file</span><br></pre></td></tr></table></figure><p>3）、修改CMS系统数据库配置。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">cat &gt; /var/www/html/config/database.php &lt;&lt; EOF</span><br><span class="line">&lt;?php</span><br><span class="line">return array(</span><br><span class="line">    &#x27;database&#x27; =&gt; array(</span><br><span class="line">        &#x27;type&#x27; =&gt; &#x27;mysqli&#x27;, // 数据库连接驱动类型: mysqli,sqlite,pdo_mysql,pdo_sqlite</span><br><span class="line">        &#x27;host&#x27; =&gt; &#x27;数据库连接地址&#x27;, // PolarDB数据库链接地址</span><br><span class="line">        &#x27;user&#x27; =&gt; &#x27;yuxiang_user&#x27;, // PolarDB数据库的用户名</span><br><span class="line">        &#x27;passwd&#x27; =&gt; &#x27;Yuxiang123&#x27;, // PolarDB数据库的密码</span><br><span class="line">        &#x27;port&#x27; =&gt; &#x27;3306&#x27;, // 数据库端口</span><br><span class="line">        &#x27;dbname&#x27; =&gt; &#x27;pbootcms&#x27; //数据库名称</span><br><span class="line">    )</span><br><span class="line">);</span><br><span class="line">EOF</span><br></pre></td></tr></table></figure><ol start="6"><li>在<strong>ECS实例</strong>列表页面，单击已创建的ECS实例ID链接进入ECS详情页，左侧导航栏，单击 <strong>本实例安全组</strong> ，然后单击安全组的ID链接查看安全组配置。</li></ol><p><img src="010.png" class="lazyload placeholder" data-srcset="010.png" srcset="https://cdn.jsdelivr.net/gh/volantis-x/cdn-volantis@3/img/placeholder/c617bfd2497fcea598e621413e315c368f8d8e.svg" alt="配置ECS安全组"></p><ol start="7"><li>访问程序。</li></ol><p>重启 Apache服务。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl restart httpd</span><br></pre></td></tr></table></figure><p>在浏览器地址栏输入云服务器的公网IP地址，进入<strong>门户网站首页</strong>。</p><p>系统后台默认访问路径为<code>http://&lt;ECS公网IP地址&gt;/admin.php</code>。默认账号为<strong>admin</strong>，密码为<strong>123456</strong>。</p><blockquote><p>至此您已完成门户网站的搭建，您可以根据公司的需求自定义门户网站的内容。</p></blockquote>]]></content>
      
      
      <categories>
          
          <category> 阿里云 </category>
          
          <category> PolarDB搭建网站 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ECS </tag>
            
            <tag> 阿里云 </tag>
            
            <tag> PolarDB </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>阿里云SLB负载均衡实践</title>
      <link href="2020/11/01/SLB%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1%E5%AE%9E%E8%B7%B5/"/>
      <url>2020/11/01/SLB%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1%E5%AE%9E%E8%B7%B5/</url>
      
        <content type="html"><![CDATA[<p>基于阿里云ECS和SLB实现负载均衡</p><a id="more"></a><h2 id="SLB简介"><a href="#SLB简介" class="headerlink" title="SLB简介"></a>SLB简介</h2><p><a href="https://help.aliyun.com/document_detail/27539.html?spm=a2c4g.11186623.6.544.16ee69f7XLFLBf">负载均衡（Server Load Balancer）</a>是将访问流量根据转发策略分发到后端多台云服务器（ECS实例）的流量分发控制服务。负载均衡扩展了应用的服务能力，增强了应用的可用性。</p><p>负载均衡通过设置<strong>虚拟服务地址</strong>，将添加的ECS实例虚拟成一个高性能、高可用的应用服务池，并根据转发规则，将来自客户端的请求分发给云服务器池中的ECS实例。</p><p>负载均衡默认检查云服务器池中ECS实例的健康状态，自动隔离异常状态的ECS实例，消除了单台ECS实例的单点故障，提高了应用的整体服务能力。此外，负载均衡还具备抗DDoS攻击的能力，增强了应用服务的防护能力。</p><h3 id="架构"><a href="#架构" class="headerlink" title="架构"></a>架构</h3><p>负载均衡服务主要有三个核心概念：</p><p><strong>负载均衡实例 （Server Load Balancer instances）</strong></p><p>一个负载均衡实例是一个运行的负载均衡服务，用来接收流量并将其分配给后端服务器。要使用负载均衡服务，您必须创建一个负载均衡实例，并至少添加一个监听和两台ECS实例。</p><p><strong>监听 （Listeners）</strong></p><p>监听用来检查客户端请求并将请求转发给后端服务器。监听也会对后端服务器进行健康检查。</p><p><strong>后端服务器（Backend Servers）</strong></p><p>一组接收前端请求的ECS实例。您可以单独添加ECS实例到服务器池，也可以通过虚拟服务器组或主备服务器组来批量添加和管理。</p><h2 id="开通资源"><a href="#开通资源" class="headerlink" title="开通资源"></a>开通资源</h2><p><a href="https://developer.aliyun.com/adc/scenario/d82547cc96d74b43a3027e0dc018cf1c">阿里云SLB负载均衡</a>，免费开通体验。</p><p>左侧显示相关资源信息。</p><p><img src="001.png" class="lazyload placeholder" data-srcset="001.png" srcset="https://cdn.jsdelivr.net/gh/volantis-x/cdn-volantis@3/img/placeholder/c617bfd2497fcea598e621413e315c368f8d8e.svg" alt="信息"></p><p><img src="002.png" class="lazyload placeholder" data-srcset="002.png" srcset="https://cdn.jsdelivr.net/gh/volantis-x/cdn-volantis@3/img/placeholder/c617bfd2497fcea598e621413e315c368f8d8e.svg" alt="信息"></p><h2 id="查看云服务器状态"><a href="#查看云服务器状态" class="headerlink" title="查看云服务器状态"></a>查看云服务器状态</h2><p>打开浏览器，访问两台ECS服务器地址，查看状态。</p><p><img src="003.png" class="lazyload placeholder" data-srcset="003.png" srcset="https://cdn.jsdelivr.net/gh/volantis-x/cdn-volantis@3/img/placeholder/c617bfd2497fcea598e621413e315c368f8d8e.svg" alt="206状态"></p><p><img src="004.png" class="lazyload placeholder" data-srcset="004.png" srcset="https://cdn.jsdelivr.net/gh/volantis-x/cdn-volantis@3/img/placeholder/c617bfd2497fcea598e621413e315c368f8d8e.svg" alt="205状态"></p><h2 id="负载均衡配置"><a href="#负载均衡配置" class="headerlink" title="负载均衡配置"></a>负载均衡配置</h2><ol><li><p>点击左侧导航栏处的 <strong>云产品资源</strong> 查看资源信息，点击 <strong>一键复制url</strong>，用浏览器登录控制台。</p></li><li><p>输入实验提供的 <strong>子用户名称</strong> 和 <strong>子用户密码</strong> ，完成后点击 <strong>登录</strong> 。登录阿里云管理控制台。</p></li><li><p>在<strong>产品与服务</strong>中搜索<strong>负载均衡</strong>，选择<strong>弹性计算</strong>下的<strong>负载均衡</strong>。</p></li></ol><p><img src="005.png" class="lazyload placeholder" data-srcset="005.png" srcset="https://cdn.jsdelivr.net/gh/volantis-x/cdn-volantis@3/img/placeholder/c617bfd2497fcea598e621413e315c368f8d8e.svg" alt="选择负载均衡"></p><ol start="4"><li>选择<strong>华东2（上海）</strong>，选择<strong>实例</strong> -》<strong>实例管理</strong>，点击<strong>点我开始配置</strong>。</li></ol><p><img src="006.png" class="lazyload placeholder" data-srcset="006.png" srcset="https://cdn.jsdelivr.net/gh/volantis-x/cdn-volantis@3/img/placeholder/c617bfd2497fcea598e621413e315c368f8d8e.svg" alt="查看负载均衡实例"></p><ol start="5"><li>通过负载均衡业务配置向导，配置负载均衡的 <strong>监听端口</strong>、<strong>后端服务器</strong> 和 <strong>健康检查</strong></li></ol><p><img src="007.png" class="lazyload placeholder" data-srcset="007.png" srcset="https://cdn.jsdelivr.net/gh/volantis-x/cdn-volantis@3/img/placeholder/c617bfd2497fcea598e621413e315c368f8d8e.svg" alt="协议&amp;监听"></p><p>1）、在 <strong>后端服务器</strong> 页面，监听请求转发至 <strong>默认服务器组</strong>，在已添加服务器处点击 <strong>继续添加</strong> 。</p><p>2）、在弹出的待添加服务器页面，在预先配置好的两台云服务器前打勾选择，然后点击<strong>下一步</strong>，之后再点击 <strong>添加</strong>；</p><p>3）、设置端口号为<strong>80</strong>，下一步。</p><p><img src="008.png" class="lazyload placeholder" data-srcset="008.png" srcset="https://cdn.jsdelivr.net/gh/volantis-x/cdn-volantis@3/img/placeholder/c617bfd2497fcea598e621413e315c368f8d8e.svg" alt="添加服务器组"></p><p><img src="009.png" class="lazyload placeholder" data-srcset="009.png" srcset="https://cdn.jsdelivr.net/gh/volantis-x/cdn-volantis@3/img/placeholder/c617bfd2497fcea598e621413e315c368f8d8e.svg" alt="开启健康检查"></p><p><img src="010.png" class="lazyload placeholder" data-srcset="010.png" srcset="https://cdn.jsdelivr.net/gh/volantis-x/cdn-volantis@3/img/placeholder/c617bfd2497fcea598e621413e315c368f8d8e.svg" alt="提交配置"></p><ol start="6"><li>刷新负载均衡实例查看状态。</li></ol><p><img src="011.png" class="lazyload placeholder" data-srcset="011.png" srcset="https://cdn.jsdelivr.net/gh/volantis-x/cdn-volantis@3/img/placeholder/c617bfd2497fcea598e621413e315c368f8d8e.svg" alt="查看状态"></p><h2 id="访问测试"><a href="#访问测试" class="headerlink" title="访问测试"></a>访问测试</h2><h3 id="权重相同"><a href="#权重相同" class="headerlink" title="权重相同"></a>权重相同</h3><p>此时，两台后端服务器的权重比例相同。</p><p>在控制台点击左侧 <strong>实例管理</strong> ，在右侧页面中的红框处看到负载均衡的 <strong>服务地址</strong>（也就是 <strong>云产品资源</strong> 提供的 <strong>负载均衡</strong> 的 <strong>IP地址</strong>）。</p><p><img src="012.png" class="lazyload placeholder" data-srcset="012.png" srcset="https://cdn.jsdelivr.net/gh/volantis-x/cdn-volantis@3/img/placeholder/c617bfd2497fcea598e621413e315c368f8d8e.svg" alt="负载均衡地址"></p><p>在浏览器中新建页面，并访问 <strong>负载均衡</strong> 的 <strong>服务地址</strong> 。界面显示的 后端服务器IP 为 <strong>云服务器ECS-1</strong>（或 <strong>云服务器ECS-2</strong>） 的 <strong>内网地址</strong> 。</p><p><strong>刷新</strong> 浏览页面，显示的 <strong>后端服务器IP</strong> 将发生变化，变为 <strong>云服务器ECS-2</strong>（或 <strong>云服务器ECS-1</strong>）的 <strong>内网地址</strong> ；</p><blockquote><p> 说明：界面显示的地址为内网地址，这是因为负载均衡访问后端ECS实例，是通过内网访问的。</p></blockquote><p><img src="013.png" class="lazyload placeholder" data-srcset="013.png" srcset="https://cdn.jsdelivr.net/gh/volantis-x/cdn-volantis@3/img/placeholder/c617bfd2497fcea598e621413e315c368f8d8e.svg" alt="分发访问请求"><br><img src="014.png" class="lazyload placeholder" data-srcset="014.png" srcset="https://cdn.jsdelivr.net/gh/volantis-x/cdn-volantis@3/img/placeholder/c617bfd2497fcea598e621413e315c368f8d8e.svg" alt="分发访问请求"></p><p>重复刷新操作，观察 <strong>后端服务器IP</strong> 是在两个云服务器的 <strong>内网地址</strong> 间轮流更换，可以减轻单台服务器的负载压力，从而确保业务的持续性。</p><h3 id="权重不同"><a href="#权重不同" class="headerlink" title="权重不同"></a>权重不同</h3><p>修改后端服务器权重，验证负载均衡向后端服务器发送请求的比例是按照权重的比例调整的。</p><p>进入<strong>实例管理</strong> 页面，点击该实例的 <strong>默认服务器组</strong> ；</p><p><img src="015.png" class="lazyload placeholder" data-srcset="015.png" srcset="https://cdn.jsdelivr.net/gh/volantis-x/cdn-volantis@3/img/placeholder/c617bfd2497fcea598e621413e315c368f8d8e.svg" alt="分发访问请求"></p><p>选中 <strong>已添加的服务器</strong> ，列表中，勾选下方的勾选框 ，然后点击 <strong>修改权重</strong> ；</p><p><img src="016.png" class="lazyload placeholder" data-srcset="016.png" srcset="https://cdn.jsdelivr.net/gh/volantis-x/cdn-volantis@3/img/placeholder/c617bfd2497fcea598e621413e315c368f8d8e.svg" alt="分发访问请求"></p><p>返回已添加的服务器的页面，查看到两台 ECS实例 的权重分别为 <strong>30</strong> 和 <strong>90</strong> ，并记录对应的 ECS实例 <strong>内网地址</strong>。</p><p><img src="017.png" class="lazyload placeholder" data-srcset="017.png" srcset="https://cdn.jsdelivr.net/gh/volantis-x/cdn-volantis@3/img/placeholder/c617bfd2497fcea598e621413e315c368f8d8e.svg" alt="分发访问请求"></p><p>浏览器中，刷新多次负载均衡 <strong>服务地址</strong> 的页面，并记录页面显示的 <strong>后端服务器IP</strong> 。可以发现：每 <strong>4</strong> 次刷新，将有 <strong>3</strong> 次访问 <strong>权重</strong> 为 <strong>90</strong> 的 ECS实例，<strong>1</strong> 次访问权重为 <strong>30</strong> 的 ECS实例。</p><blockquote><p>结果：证明用户可以根据实际情况调整负载均衡器的请求分发，一般将配置高的服务器设置的权重调高，配置较低的服务器设置的权重调低。这样可以避免在高并发时，配置较低的服务器因为压力较大服务异常的发生。</p></blockquote><h3 id="模拟宕机"><a href="#模拟宕机" class="headerlink" title="模拟宕机"></a>模拟宕机</h3><p>首先开启负载均衡的 <strong>会话保持</strong> 功能。</p><p>1）点击左侧 <strong>监听</strong> ，监听页面点击右侧的 <strong>修改监听配置</strong> 。</p><p><img src="018.png" class="lazyload placeholder" data-srcset="018.png" srcset="https://cdn.jsdelivr.net/gh/volantis-x/cdn-volantis@3/img/placeholder/c617bfd2497fcea598e621413e315c368f8d8e.svg" alt="监听"></p><p>2） 配置监听页面的 <strong>高级配置</strong> 处，点击 <strong>修改</strong> ；</p><p><img src="019.png" class="lazyload placeholder" data-srcset="019.png" srcset="https://cdn.jsdelivr.net/gh/volantis-x/cdn-volantis@3/img/placeholder/c617bfd2497fcea598e621413e315c368f8d8e.svg" alt="配置"></p><p>3）开启 <strong>会话保持</strong> ，超时时间 输入 <strong>180</strong> （即 <strong>3</strong> 分钟）；完成后点击 <strong>下一步</strong> </p><p><img src="020.png" class="lazyload placeholder" data-srcset="020.png" srcset="https://cdn.jsdelivr.net/gh/volantis-x/cdn-volantis@3/img/placeholder/c617bfd2497fcea598e621413e315c368f8d8e.svg" alt="开启会话保持"></p><p>4）下面的 <strong>后端服务器</strong>、<strong>健康检查</strong> 和 <strong>配置审核</strong> 页面都采用默认值 ，依次完成配置。</p><p>返回到 <strong>监听</strong> 页面 ，会话保持 状态 <strong>已开启</strong> 。</p><p><img src="021.png" class="lazyload placeholder" data-srcset="021.png" srcset="https://cdn.jsdelivr.net/gh/volantis-x/cdn-volantis@3/img/placeholder/c617bfd2497fcea598e621413e315c368f8d8e.svg" alt="查看会话保持开启"></p><p>再次在浏览器中输入 <strong>负载均衡</strong> 的 <strong>IP地址</strong> ，多次刷新，发现在会话保持的超时时间内请求只会分发到某一台 ECS 上（究竟是哪一台 ECS 没有规定），时间超出后，重新按照权重比例分发。</p><p><img src="022.png" class="lazyload placeholder" data-srcset="022.png" srcset="https://cdn.jsdelivr.net/gh/volantis-x/cdn-volantis@3/img/placeholder/c617bfd2497fcea598e621413e315c368f8d8e.svg" alt="开启会话保持访问测试"></p><p><strong>我们关掉刚才访问的那台机器。</strong></p><p><img src="023.png" class="lazyload placeholder" data-srcset="023.png" srcset="https://cdn.jsdelivr.net/gh/volantis-x/cdn-volantis@3/img/placeholder/c617bfd2497fcea598e621413e315c368f8d8e.svg" alt="关闭ECS实例"></p><p><img src="024.png" class="lazyload placeholder" data-srcset="024.png" srcset="https://cdn.jsdelivr.net/gh/volantis-x/cdn-volantis@3/img/placeholder/c617bfd2497fcea598e621413e315c368f8d8e.svg" alt="关闭ECS实例"></p><p>返回负载均衡管理控制台，在默认服务器组页面中点击右上角的【刷新】，页面刷新后被停止的 ECS 的 状态 变为 <strong>已停止</strong>。<strong>监听</strong> 页面，也出现 <strong>异常</strong> 提示 。</p><p><img src="025.png" class="lazyload placeholder" data-srcset="025.png" srcset="https://cdn.jsdelivr.net/gh/volantis-x/cdn-volantis@3/img/placeholder/c617bfd2497fcea598e621413e315c368f8d8e.svg" alt="查看状态"></p><p><img src="026.png" class="lazyload placeholder" data-srcset="026.png" srcset="https://cdn.jsdelivr.net/gh/volantis-x/cdn-volantis@3/img/placeholder/c617bfd2497fcea598e621413e315c368f8d8e.svg" alt="查看状态"></p><p>点击左上角的 【实例管理 】，返回负载均衡管理控制台主页面，<strong>异常</strong> 报警也会出现。</p><p><img src="027.png" class="lazyload placeholder" data-srcset="027.png" srcset="https://cdn.jsdelivr.net/gh/volantis-x/cdn-volantis@3/img/placeholder/c617bfd2497fcea598e621413e315c368f8d8e.svg" alt="查看状态"></p><p>再次刷新浏览器中 负载均衡 的 IP地址 ，此时，请求发送到 健康检查状态 为 <strong>正常</strong> 的ECS上。</p><p><img src="028.png" class="lazyload placeholder" data-srcset="028.png" srcset="https://cdn.jsdelivr.net/gh/volantis-x/cdn-volantis@3/img/placeholder/c617bfd2497fcea598e621413e315c368f8d8e.svg" alt="查看状态"></p><blockquote><p>结果：当某一台 ECS 出现异常后，负载均衡会自动将请求发送到健康检查状态正常的 ECS 上。</p></blockquote>]]></content>
      
      
      <categories>
          
          <category> 阿里云 </category>
          
          <category> SBL负载均衡 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ECS </tag>
            
            <tag> 阿里云 </tag>
            
            <tag> SLB </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>阿里云ECS搭建Docker环境</title>
      <link href="2020/10/31/ECS%E6%90%AD%E5%BB%BADocker%E7%8E%AF%E5%A2%83/"/>
      <url>2020/10/31/ECS%E6%90%AD%E5%BB%BADocker%E7%8E%AF%E5%A2%83/</url>
      
        <content type="html"><![CDATA[<p>基于阿里云ECS搭建Docker环境、服务简单部署</p><a id="more"></a><h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>Docker 是一个开源的应用容器引擎，基于 Go 语言 并遵从 Apache2.0 协议开源。</p><p>Docker 可以让开发者打包他们的应用以及依赖包到一个轻量级、可移植的容器中，然后发布到任何流行的 Linux 机器上，也可以实现虚拟化。容器是完全使用沙箱机制，相互之间不会有任何接口,更重要的是容器性能开销极低。</p><p>Docker名词解释：</p><p><strong>镜像</strong>：Docker 镜像是容器应用打包的标准格式，是创建容器的模板。</p><p><strong>容器</strong>：一个通过 Docker 镜像创建的运行时实例，一台主机可运行多个同一镜像的容器实例。</p><h2 id="安装、启动"><a href="#安装、启动" class="headerlink" title="安装、启动"></a>安装、启动</h2><ol><li>首先开通<a href="https://developer.aliyun.com/adc/scenario/exp/9fd79b8711984e309f20d82bc65a26fa">阿里云ECS资源</a>，免费体验，还在等什么呢。</li></ol><p><img src="001.png" class="lazyload placeholder" data-srcset="001.png" srcset="https://cdn.jsdelivr.net/gh/volantis-x/cdn-volantis@3/img/placeholder/c617bfd2497fcea598e621413e315c368f8d8e.svg" alt="ECS资源"></p><ol start="2"><li>连接。</li></ol><blockquote><p>用 CMD Powershell Terminal均可, 我在此使用CMD</p><p>命令：ssh [username]@[ipaddress]</p></blockquote><p><img src="002.png" class="lazyload placeholder" data-srcset="002.png" srcset="https://cdn.jsdelivr.net/gh/volantis-x/cdn-volantis@3/img/placeholder/c617bfd2497fcea598e621413e315c368f8d8e.svg" alt="连接"></p><ol start="3"><li>安装Docker CE。</li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 1. 安装Docker依赖库</span></span><br><span class="line">yum install -y yum-utils device-mapper-persistent-data lvm2</span><br><span class="line"><span class="meta">#</span><span class="bash"> 2. 安装Docker CE的软件源信息</span></span><br><span class="line">yum-config-manager --add-repo http://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo</span><br><span class="line"><span class="meta">#</span><span class="bash"> 3. 安装Docker CE</span></span><br><span class="line">yum makecache fast</span><br><span class="line">yum -y install docker-ce</span><br><span class="line"><span class="meta">#</span><span class="bash"> 4. 启动Docker服务</span></span><br><span class="line">systemctl start docker</span><br><span class="line"><span class="meta">#</span><span class="bash"> 查看Docker启动情况</span></span><br><span class="line">systemctl status docker</span><br></pre></td></tr></table></figure><p><img src="003.png" class="lazyload placeholder" data-srcset="003.png" srcset="https://cdn.jsdelivr.net/gh/volantis-x/cdn-volantis@3/img/placeholder/c617bfd2497fcea598e621413e315c368f8d8e.svg" alt="启动、查看"></p><h2 id="配置镜像加速"><a href="#配置镜像加速" class="headerlink" title="配置镜像加速"></a>配置镜像加速</h2><p>Docker的默认官方远程仓库是<a href="https://hub.docker.com/">hub.docker.com</a>，由于网络原因，下载一个Docker官方镜像可能会需要很长的时间，甚至下载失败。为此，阿里云容器镜像服务ACR提供了官方的镜像站点，从而加速官方镜像的下载。下面介绍如何使用阿里云镜像仓库。</p><ol><li>使用子账户登录阿里云。</li></ol><p><img src="004.png" class="lazyload placeholder" data-srcset="004.png" srcset="https://cdn.jsdelivr.net/gh/volantis-x/cdn-volantis@3/img/placeholder/c617bfd2497fcea598e621413e315c368f8d8e.svg" alt="子账户信息"></p><p>在页面左侧资源栏点击 <strong>一键复制登录url</strong>，在浏览器中打开。<strong>进行RAM用户登录</strong>。</p><p>在左侧产品与服务中搜索<strong>镜像</strong>。</p><p><img src="005.png" class="lazyload placeholder" data-srcset="005.png" srcset="https://cdn.jsdelivr.net/gh/volantis-x/cdn-volantis@3/img/placeholder/c617bfd2497fcea598e621413e315c368f8d8e.svg" alt="搜索镜像服务"></p><p>单击<strong>容器镜像服务</strong>，若提示未开通服务，关闭即可。</p><ol start="2"><li>单击【镜像中心】 &gt; 【镜像加速器】，可以看到阿里云为您提供了一个专属的镜像加速地址。</li></ol><p><img src="006.png" class="lazyload placeholder" data-srcset="006.png" srcset="https://cdn.jsdelivr.net/gh/volantis-x/cdn-volantis@3/img/placeholder/c617bfd2497fcea598e621413e315c368f8d8e.svg" alt="查看加速地址"></p><ol start="3"><li>配置Docker仓库地址为在 【镜像加速器】中的加速器地址。</li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[root@i1kzth4Z ~]# ls /etc/docker/</span><br><span class="line">key.json</span><br><span class="line">[root@i1kzth4Z ~]# cat &gt;&gt; /etc/docker/daemon.json &lt;&lt; EOF</span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> &#123;</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> <span class="string">&quot;registry-mirrors&quot;</span>: [<span class="string">&quot;https://xxxx.aliyuncs.com&quot;</span>]</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> &#125;</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> EOF</span></span><br><span class="line">[root@i1kzth4Z ~]# cat /etc/docker/daemon.json</span><br><span class="line">&#123;</span><br><span class="line">&quot;registry-mirrors&quot;: [&quot;https://xxxx.aliyuncs.com&quot;]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol start="4"><li>重新加载配置文件，重启服务。</li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 加载配置文件</span></span><br><span class="line">systemctl daemon-reload</span><br><span class="line"><span class="meta">#</span><span class="bash"> 重启服务</span></span><br><span class="line">systemctl restart docker</span><br></pre></td></tr></table></figure><h2 id="Docker常用命令"><a href="#Docker常用命令" class="headerlink" title="Docker常用命令"></a>Docker常用命令</h2><h3 id="docker-search"><a href="#docker-search" class="headerlink" title="docker search"></a>docker search</h3><blockquote><p>根据名字搜索镜像</p><p>用法：docker search [OPTIONS] TERM</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[root@iicxcxq7nz ~]# docker search nginx</span><br><span class="line">NAME                               DESCRIPTION                                     STARS               OFFICIAL            AUTOMATED</span><br><span class="line">nginx                              Official build of Nginx.                        13942               [OK]                </span><br><span class="line">jwilder/nginx-proxy                Automated Nginx reverse proxy for docker con…   1902                                    [OK]</span><br><span class="line">richarvey/nginx-php-fpm            Container running Nginx + PHP-FPM capable of…   791                                     [OK]</span><br><span class="line">linuxserver/nginx                  An Nginx container, brought to you by LinuxS…   128                                     </span><br><span class="line">jc21/nginx-proxy-manager           Docker container for managing Nginx proxy ho…   106                                     </span><br><span class="line">tiangolo/nginx-rtmp                Docker image with Nginx using the nginx-rtmp…   101                                     [OK]</span><br></pre></td></tr></table></figure><h3 id="docker-pull"><a href="#docker-pull" class="headerlink" title="docker pull"></a>docker pull</h3><blockquote><p>从远程仓库拉去镜像</p><p>用法：docker pull [OPTIONS] NAME[:TAG|@DIGEST]</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[root@iicxcxq7nz ~]# docker pull nginx:latest</span><br><span class="line">latest: Pulling from library/nginx</span><br><span class="line">bb79b6b2107f: Already exists </span><br><span class="line">111447d5894d: Pull complete </span><br><span class="line">a95689b8e6cb: Pull complete </span><br><span class="line">1a0022e444c2: Pull complete </span><br><span class="line">32b7488a3833: Pull complete </span><br><span class="line">Digest: sha256:ed7f815851b5299f616220a63edac69a4cc200e7f536a56e421988da82e44ed8</span><br><span class="line">Status: Downloaded newer image for nginx:latest</span><br><span class="line">docker.io/library/nginx:latest</span><br></pre></td></tr></table></figure><h3 id="docker-images"><a href="#docker-images" class="headerlink" title="docker images"></a>docker images</h3><blockquote><p>查看本地镜像列表</p><p>用法：docker images [OPTIONS] [REPOSITORY[:TAG]]</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[root@iicxcxq7nz ~]# docker images nginx:latest</span><br><span class="line">REPOSITORY          TAG                 IMAGE ID            CREATED             SIZE</span><br><span class="line">nginx               latest              f35646e83998        2 weeks ago         133MB</span><br><span class="line">[root@iicxcxq7nz ~]# docker images</span><br><span class="line">REPOSITORY                                                TAG                 IMAGE ID            CREATED             SIZE</span><br><span class="line">nginx                                                     latest              f35646e83998        2 weeks ago         133MB</span><br><span class="line">mysql                                                     5.7                 42cdba9f1b08        2 weeks ago         448MB</span><br><span class="line">nginx                                                     1.12                4037a5562b03        2 years ago         108MB</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="docker-run"><a href="#docker-run" class="headerlink" title="docker run"></a>docker run</h3><blockquote><p>通过镜像开始一个运行实例</p><p>用法：docker run [OPTIONS] IMAGE [COMMAND] [ARG…]</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root@iicxcxq7nz ~]# docker run --name mysql \</span><br><span class="line">-p 3306:3306 \</span><br><span class="line">-v /home/mysql/conf/my.cnf:/etc/mysql/my.cnf \</span><br><span class="line">-v /home/mysql/logs:/logs \</span><br><span class="line">-v /home/mysql/data/mysql:/var/lib/mysql \ </span><br><span class="line">-e MYSQL_ROOT_PASSWORD=123456 \</span><br><span class="line">-d mysql:5.6 \</span><br></pre></td></tr></table></figure><blockquote><p><code>--name</code>：设置容器实例名称</p><p><code>-p</code>：宿主机与容器端口绑定</p><p><code>-v</code>：挂载目录或数据卷，将容器内的文件夹与宿主机文件夹映射，方便修改容器内的文件。</p><p><code>-e</code>：设置容器内MySQL服务Root用户密码</p><p><code>-d</code>：后台守护运行，返回容器实例ID</p></blockquote><h3 id="docker-ps"><a href="#docker-ps" class="headerlink" title="docker ps"></a>docker ps</h3><blockquote><p>查看容器</p><p>用法：docker ps [OPTIONS]</p><p>参数:</p><p><code>-a</code>：显示全部</p><p><code>-n &lt;num&gt;</code>：显示最新运行的<num>个容器</p><p><code>-l</code>：显示最新创建的容器(包括所有状态)</p><p><code>-q</code>：仅显示容器ID</p><p><code>-s</code>：显示容器总大小</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@iicxcxq7nz demo]# docker ps</span><br><span class="line">CONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS              PORTS                  NAMES</span><br><span class="line">33a5981c417d        nginx:latest        &quot;/docker-entrypoint.…&quot;   8 minutes ago       Up 8 minutes        0.0.0.0:8080-&gt;80/tcp   nginx-test</span><br><span class="line">[root@iicxcxq7nz demo]# docker ps -s</span><br><span class="line">CONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS              PORTS                  NAMES               SIZE</span><br><span class="line">33a5981c417d        nginx:latest        &quot;/docker-entrypoint.…&quot;   8 minutes ago       Up 8 minutes        0.0.0.0:8080-&gt;80/tcp   nginx-test          1.29kB (virtual 133MB)</span><br></pre></td></tr></table></figure><h2 id="搭建Nginx服务"><a href="#搭建Nginx服务" class="headerlink" title="搭建Nginx服务"></a>搭建Nginx服务</h2><ol><li>拉取最新Nginx镜像。</li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker pull nginx:latest</span><br></pre></td></tr></table></figure><ol start="2"><li>运行容器。</li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run --name nginx-test -p 8080:80 -d nginx:latest</span><br></pre></td></tr></table></figure><p>运行结果如下</p><p><img src="007.png" class="lazyload placeholder" data-srcset="007.png" srcset="https://cdn.jsdelivr.net/gh/volantis-x/cdn-volantis@3/img/placeholder/c617bfd2497fcea598e621413e315c368f8d8e.svg" alt="运行容器"></p><ol start="3"><li> 在浏览器地址栏输入<code>http://&lt;公网地址&gt;:8080</code>访问Nginx服务。</li></ol><p><img src="008.png" class="lazyload placeholder" data-srcset="008.png" srcset="https://cdn.jsdelivr.net/gh/volantis-x/cdn-volantis@3/img/placeholder/c617bfd2497fcea598e621413e315c368f8d8e.svg" alt="运行测试"></p>]]></content>
      
      
      <categories>
          
          <category> 阿里云 </category>
          
          <category> Docker </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ECS </tag>
            
            <tag> Docker </tag>
            
            <tag> 阿里云 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>阿里云ECS搭建FTP服务</title>
      <link href="2020/10/30/ECS%E6%90%AD%E5%BB%BAFTP%E6%9C%8D%E5%8A%A1/"/>
      <url>2020/10/30/ECS%E6%90%AD%E5%BB%BAFTP%E6%9C%8D%E5%8A%A1/</url>
      
        <content type="html"><![CDATA[<p>基于ECS，使用vsftpd搭建FTP服务</p><a id="more"></a><h2 id="环境"><a href="#环境" class="headerlink" title="环境"></a>环境</h2><ul><li>CentOS Linux release 7.3.1611</li><li>vsftpd-3.0.2-27.el7.x86_64</li></ul><h2 id="前置知识"><a href="#前置知识" class="headerlink" title="前置知识"></a>前置知识</h2><ol><li>chmod命令</li></ol><blockquote><p>Linux/Unix 的文件调用权限分为三级 : 文件所有者（Owner）、用户组（Group）、其它用户（Other Users）</p></blockquote><p><img src="file-permissions-rwx.jpg" class="lazyload placeholder" data-srcset="file-permissions-rwx.jpg" srcset="https://cdn.jsdelivr.net/gh/volantis-x/cdn-volantis@3/img/placeholder/c617bfd2497fcea598e621413e315c368f8d8e.svg" alt="文件权限"></p><p><strong>语法</strong>&amp;<strong>例子</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">chmod [-cfvR] [--help] [--version] mode file...</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> u：用户  g：组  o：其他  a：全部</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 将文件 file1.txt 设为所有人皆可读取</span></span><br><span class="line">chmod ugo+r file1.txt # 或  chmod a+r file1.txt</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 也可以用数字代替 4=r，2=w，1=x  </span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 将目前目录下的所有文件与子目录皆设为任何人可读取</span></span><br><span class="line">chmod 777 * # 或 chmod a+rwx *</span><br></pre></td></tr></table></figure><ol start="2"><li>chown命令</li></ol><blockquote><p>Linux chown（英文全拼：<strong>change owner</strong>）命令用于设置文件所有者和文件关联组的命令。</p><p>Linux/Unix 是多人多工操作系统，所有的文件皆有拥有者。利用 chown 将指定文件的拥有者改为指定的用户或组，用户可以是用户名或者用户 ID，组可以是组名或者组 ID，文件是以空格分开的要改变权限的文件列表，支持通配符。</p><p>chown 需要超级用户 <strong>root</strong> 的权限才能执行此命令。</p></blockquote><p><strong>语法</strong>&amp;<strong>例子</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">chown [-cfhvR] [--help] [--version] user[:group] file...</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 将文件 file1.txt 的拥有者设为 yuxiang，群体的使用者 yuxianggroup</span></span><br><span class="line">chown yuxiang:yuxianggroup file1.txt</span><br><span class="line"><span class="meta">#</span><span class="bash"> 将当前前目录下的所有文件与子目录的拥有者皆设为 yuxiang，群体的使用者 yuxianggroup</span></span><br><span class="line">chown -R yuxiang:yuxianggroup *</span><br><span class="line"><span class="meta">#</span><span class="bash"> -R : 处理指定目录以及其子目录下的所有文件</span></span><br></pre></td></tr></table></figure><ol start="3"><li><a href="https://www.runoob.com/linux/linux-comm-sed.html">sed命令</a></li></ol><blockquote><p>Linux sed 命令是利用脚本来处理文本文件。</p><p>sed 可依照脚本的指令来处理、编辑文本文件。</p><p>Sed 主要用来自动编辑一个或多个文件、简化对文件的反复操作、编写转换程序等。</p></blockquote><ol start="4"><li>ftp客户端命令</li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">进入ftp客户端</span></span><br><span class="line">ftp</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">打开ftp服务器</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">open xxx.xxx.xxx.xxx</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">查看远程目录</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">dir</span></span><br><span class="line"><span class="meta">#</span><span class="bash">查看本地目录</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">!dir </span></span><br><span class="line"><span class="meta">#</span><span class="bash">指定本地目录</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">lcd</span></span><br><span class="line"><span class="meta">#</span><span class="bash">切换远程目录</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"><span class="built_in">cd</span> 目录</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">上传文件</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">put 文件名</span></span><br><span class="line"><span class="meta">#</span><span class="bash">上传文件,支持*通配</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">mput 文件名</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">下载文件</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">get  文件名</span></span><br><span class="line"><span class="meta">#</span><span class="bash">下载文件,支持*通配</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">mget 文件名</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">删除远程文件</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">delete 文件名</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">退出服务器</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"><span class="built_in">bye</span></span></span><br></pre></td></tr></table></figure><h2 id="开通、连接资源"><a href="#开通、连接资源" class="headerlink" title="开通、连接资源"></a>开通、连接资源</h2><p><a href="https://developer.aliyun.com/adc/scenario/exp/74b64efe414c47fbaf305957a7fb458b">阿里云ECS搭建FTP服务</a>开通资源，免费体验。</p><p><img src="001.png" class="lazyload placeholder" data-srcset="001.png" srcset="https://cdn.jsdelivr.net/gh/volantis-x/cdn-volantis@3/img/placeholder/c617bfd2497fcea598e621413e315c368f8d8e.svg" alt="资源信息"></p><p><strong>连接</strong> ：使用<code>CMD</code>、<code>Powershell</code>、<code>Xshell</code>等工具都可以。</p><p><img src="002.png" class="lazyload placeholder" data-srcset="002.png" srcset="https://cdn.jsdelivr.net/gh/volantis-x/cdn-volantis@3/img/placeholder/c617bfd2497fcea598e621413e315c368f8d8e.svg" alt="连接资源"></p><h2 id="安装、启动vsftpd"><a href="#安装、启动vsftpd" class="headerlink" title="安装、启动vsftpd"></a>安装、启动vsftpd</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 1. 安装</span></span><br><span class="line">yum install -y vsftpd</span><br><span class="line"><span class="meta">#</span><span class="bash"> 2. 运行</span></span><br><span class="line">systemctl start vsftpd.service</span><br><span class="line"><span class="meta">#</span><span class="bash"> 3. 查看运行结果</span></span><br><span class="line">systemctl status vsftpd.service</span><br><span class="line">netstat -tunap | grep ftp</span><br></pre></td></tr></table></figure><p><img src="003.png" class="lazyload placeholder" data-srcset="003.png" srcset="https://cdn.jsdelivr.net/gh/volantis-x/cdn-volantis@3/img/placeholder/c617bfd2497fcea598e621413e315c368f8d8e.svg" alt="查看运行结果"></p><h2 id="配置vsftpd"><a href="#配置vsftpd" class="headerlink" title="配置vsftpd"></a>配置vsftpd</h2><p>vsftpd（very secure FTP daemon）是一款在Linux发行版中最受推崇的FTP服务器。vsftpd支持匿名访问和本地用户模式两种访问方式。匿名访问方式任何用户都可以访问搭建的FTP服务；本地用户模式只支持添加的本地用户访问搭建的FTP服务。</p><blockquote><p>说明: <strong>匿名用户模式</strong>和<strong>本地用户</strong>模式只可同时配置一种。</p></blockquote><h3 id="匿名用户模式"><a href="#匿名用户模式" class="headerlink" title="匿名用户模式"></a>匿名用户模式</h3><ol><li>修改配置文件vsftpd.conf。</li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/vsftpd/vsftpd.conf</span><br></pre></td></tr></table></figure><p>将匿名长传权限<code>anon_upload_enable=YES</code>的注释解开。</p><ol start="2"><li>退出编辑模式，输入<code>:wq</code>保存并退出vim编辑器。</li><li>为FTP用户添加写权限。</li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">chmod o+w /var/ftp/pub/</span><br></pre></td></tr></table></figure><ol start="4"><li>重启服务。</li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl restart vsftpd.service</span><br></pre></td></tr></table></figure><ol start="5"><li>访问测试。</li></ol><p>在/var/ftp/pub目录下创建hello.js文件</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[root@ic5x28dikeZ ~]# cd /var/ftp/pub/</span><br><span class="line">[root@ic5x28dikeZ pub]# touch hello.js</span><br><span class="line">[root@ic5x28dikeZ pub]# cat &gt;&gt; ./hello.js &lt;&lt; EOF</span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> console.log(<span class="string">&#x27;hello world vsftpd&#x27;</span>);</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> EOF</span></span><br><span class="line">[root@c5x28dikeZ pub]# cat hello.js</span><br><span class="line">console.log(&#x27;hello world vsftpd&#x27;);</span><br><span class="line">[root@ic5x28dikeZ pub]#</span><br></pre></td></tr></table></figure><p><img src="004.png" class="lazyload placeholder" data-srcset="004.png" srcset="https://cdn.jsdelivr.net/gh/volantis-x/cdn-volantis@3/img/placeholder/c617bfd2497fcea598e621413e315c368f8d8e.svg" alt="访问测试"></p><h3 id="本地用户模式"><a href="#本地用户模式" class="headerlink" title="本地用户模式"></a>本地用户模式</h3><ol><li>为FTP服务创建一个Liunx用户。</li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 创建用户</span></span><br><span class="line">adduser ftptest</span><br><span class="line"><span class="meta">#</span><span class="bash"> 设置密码</span></span><br><span class="line">passwd ftptest</span><br></pre></td></tr></table></figure><p><img src="005.png" class="lazyload placeholder" data-srcset="005.png" srcset="https://cdn.jsdelivr.net/gh/volantis-x/cdn-volantis@3/img/placeholder/c617bfd2497fcea598e621413e315c368f8d8e.svg" alt="设置密码"></p><ol start="2"><li>创建一个供FTP服务使用的文件目录。</li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mkdir /var/ftp/test</span><br></pre></td></tr></table></figure><ol start="3"><li>更改/var/ftp/test目录的拥有者为ftptest.</li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">chowm -R ftptest:ftptest /var/ftp/test</span><br></pre></td></tr></table></figure><ol start="4"><li>修改/etc/vsftpd/vsftpd.conf配置文件。</li></ol><p><strong>FTP两种模式</strong>：主动模式、被动模式。详细可自行搜索。</p><ul><li>主动模式配置</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">sed -i &#x27;s/anonymous_enable=YES/anonymous_enable=NO/&#x27; /etc/vsftpd/vsftpd.conf #禁止匿名登录FTP服务器 </span><br><span class="line">sed -i &#x27;s/listen=NO/listen=YES/&#x27; /etc/vsftpd/vsftpd.conf #监听IPv4 sockets </span><br><span class="line">sed -i &#x27;s/listen_ipv6=YES/#listen_ipv6=YES/&#x27; /etc/vsftpd/vsftpd.conf #关闭监听IPv6 sockets </span><br><span class="line">sed -i &#x27;s/#chroot_local_user=YES/chroot_local_user=YES/&#x27; /etc/vsftpd/vsftpd.conf #全部用户被限制在主目录 </span><br><span class="line">sed -i &#x27;s/#chroot_list_enable=YES/chroot_list_enable=YES/&#x27; /etc/vsftpd/vsftpd.conf #启用例外用户名单 </span><br><span class="line">sed -i &#x27;s/#chroot_list_file=/chroot_list_file=/&#x27; /etc/vsftpd/vsftpd.conf #指定例外用户列表文件，列表中的用户不被锁定在主目录 </span><br><span class="line">echo &quot;allow_writeable_chroot=YES&quot; &gt;&gt; /etc/vsftpd/vsftpd.conf </span><br><span class="line">echo &quot;local_root=/var/ftp/test&quot; &gt;&gt; /etc/vsftpd/vsftpd.conf #设置本地用户登录后所在的目录</span><br></pre></td></tr></table></figure><ul><li>被动模式配置</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">sed -i &#x27;s/anonymous_enable=YES/anonymous_enable=NO/&#x27; /etc/vsftpd/vsftpd.conf #禁止匿名登录FTP服务器 </span><br><span class="line">sed -i &#x27;s/listen=NO/listen=YES/&#x27; /etc/vsftpd/vsftpd.conf #监听IPv4 sockets </span><br><span class="line">sed -i &#x27;s/listen_ipv6=YES/#listen_ipv6=YES/&#x27; /etc/vsftpd/vsftpd.conf #关闭监听IPv6 sockets </span><br><span class="line">sed -i &#x27;s/#chroot_local_user=YES/chroot_local_user=YES/&#x27; /etc/vsftpd/vsftpd.conf #全部用户被限制在主目录 </span><br><span class="line">sed -i &#x27;s/#chroot_list_enable=YES/chroot_list_enable=YES/&#x27; /etc/vsftpd/vsftpd.conf #启用例外用户名单 </span><br><span class="line">sed -i &#x27;s/#chroot_list_file=/chroot_list_file=/&#x27; /etc/vsftpd/vsftpd.conf #指定例外用户列表文件，列表中的用户不被锁定在主目录 </span><br><span class="line">echo &quot;allow_writeable_chroot=YES&quot; &gt;&gt; /etc/vsftpd/vsftpd.conf </span><br><span class="line">echo &quot;local_root=/var/ftp/test&quot; &gt;&gt; /etc/vsftpd/vsftpd.conf #设置本地用户登录后所在的目录 </span><br><span class="line"></span><br><span class="line">echo &quot;pasv_enable=YES&quot; &gt;&gt; /etc/vsftpd/vsftpd.conf #开启被动模式 </span><br><span class="line">echo &quot;pasv_address=&lt;FTP服务器公网IP地址&gt;&quot; &gt;&gt; /etc/vsftpd/vsftpd.conf #本教程中为ECS服务器弹性IP </span><br><span class="line">echo &quot;pasv_min_port=20&quot; &gt;&gt; /etc/vsftpd/vsftpd.conf #设置被动模式下，建立数据传输可使用的端口范围的最小值 </span><br><span class="line">echo &quot;pasv_max_port=21&quot; &gt;&gt; /etc/vsftpd/vsftpd.conf #设置被动模式下，建立数据传输可使用的端口范围的最大值</span><br></pre></td></tr></table></figure><ol start="5"><li>在/etc/vsftpd目录下创建chroot_list文件，并在在文件中写入例外用户名单。</li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">使用vim命令编辑chroot_list文件，添加例外用户名单。此名单中的用户不会被锁定在主目录，可以访问其他目录。</span></span><br><span class="line">vim /etc/vsftpd/chroot_list</span><br><span class="line"><span class="meta">#</span><span class="bash"> 添加用户</span></span><br><span class="line">ftptest</span><br><span class="line"><span class="meta">#</span><span class="bash"> 保存退出</span></span><br></pre></td></tr></table></figure><blockquote><p>说明：没有例外用户时，也必须创建chroot_list文件，内容可为空。</p></blockquote><ol start="6"><li>重启服务。</li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl restart vsftpd.service</span><br></pre></td></tr></table></figure><ol start="7"><li>测试。</li></ol><p>浏览器访问测试。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">[root@iicxcxq7nz test]# touch TestMain.java</span><br><span class="line">[root@iicxcxq7nz test]# cat &gt;&gt; ./TestMain.java &lt;&lt; EOF</span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> public class TestMain &#123;</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">     public static void main(String agrs[]) &#123;</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">         System.out.println(<span class="string">&#x27;hello vsftpd user&#x27;</span>);</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">     &#125;</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> &#125;</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> EOF</span></span><br><span class="line">[root@iicxcxq7nz test]# tree /var/ftp/test/</span><br><span class="line">test/</span><br><span class="line">└── yuxiang</span><br><span class="line">    └── TestMain.java</span><br><span class="line"></span><br><span class="line">1 directory, 1 file</span><br></pre></td></tr></table></figure><p><img src="006.png" class="lazyload placeholder" data-srcset="006.png" srcset="https://cdn.jsdelivr.net/gh/volantis-x/cdn-volantis@3/img/placeholder/c617bfd2497fcea598e621413e315c368f8d8e.svg" alt="登录"></p><p><img src="007.png" class="lazyload placeholder" data-srcset="007.png" srcset="https://cdn.jsdelivr.net/gh/volantis-x/cdn-volantis@3/img/placeholder/c617bfd2497fcea598e621413e315c368f8d8e.svg" alt="查看文件"></p><p>ftp工具上传测试。</p><p><img src="008.png" class="lazyload placeholder" data-srcset="008.png" srcset="https://cdn.jsdelivr.net/gh/volantis-x/cdn-volantis@3/img/placeholder/c617bfd2497fcea598e621413e315c368f8d8e.svg" alt="连接登录"></p><p><img src="009.png" class="lazyload placeholder" data-srcset="009.png" srcset="https://cdn.jsdelivr.net/gh/volantis-x/cdn-volantis@3/img/placeholder/c617bfd2497fcea598e621413e315c368f8d8e.svg" alt="上传下载"></p>]]></content>
      
      
      <categories>
          
          <category> 阿里云 </category>
          
          <category> ftp服务 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ECS </tag>
            
            <tag> 阿里云 </tag>
            
            <tag> vsftpd </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>MySQL索引和事务介绍</title>
      <link href="2020/10/21/MySQL%E7%B4%A2%E5%BC%95%E5%92%8C%E4%BA%8B%E5%8A%A1%E4%BB%8B%E7%BB%8D/"/>
      <url>2020/10/21/MySQL%E7%B4%A2%E5%BC%95%E5%92%8C%E4%BA%8B%E5%8A%A1%E4%BB%8B%E7%BB%8D/</url>
      
        <content type="html"><![CDATA[<p>MySQL索引介绍和事务演示</p><a id="more"></a><h2 id="环境"><a href="#环境" class="headerlink" title="环境"></a>环境</h2><p><strong>版本</strong>：mysql 8.0.17</p><h2 id="索引"><a href="#索引" class="headerlink" title="索引"></a>索引</h2><h3 id="索引介绍"><a href="#索引介绍" class="headerlink" title="索引介绍"></a>索引介绍</h3><ul><li>索引是帮助MySQL高效获取数据的数据结构</li><li>索引存储在文件系统中</li><li>索引的文件形式与存储引擎有关</li><li>索引文件的结构<ul><li>hash</li><li>二叉树</li><li>B树</li><li>B+树</li></ul></li></ul><h3 id="索引的优点"><a href="#索引的优点" class="headerlink" title="索引的优点"></a>索引的优点</h3><ol><li>大大减少了服务器需要扫描的数据量</li><li>帮助服务器避免排序和临时表</li><li>将随机io变成顺序io</li></ol><h3 id="索引的用处"><a href="#索引的用处" class="headerlink" title="索引的用处"></a>索引的用处</h3><ol><li>快速查找WHERE子句匹配的行</li><li>如果表具有多列索引，则优化器可以使用索引的任何最左前缀来查找行</li><li>当有表连接的时候，从替他表检索行数据</li><li>查找特定索引列的min或max值</li><li>如果排序分组时可在索引的最左前缀上完成的，则对表进行排序和分组</li><li>在某些情况下，可以优化查询以检索值而无需查询数据行</li><li>从consideration中消除行，如果可以在多个索引之间进行选择，mysql通常会使用到最少行的索引</li></ol><h3 id="索引的分类"><a href="#索引的分类" class="headerlink" title="索引的分类"></a>索引的分类</h3><ul><li>主键索引</li><li>唯一索引</li><li>普通索引</li><li>全文索引</li><li>组合索引</li></ul><h3 id="技术名词"><a href="#技术名词" class="headerlink" title="技术名词"></a>技术名词</h3><p><strong>回表</strong></p><blockquote><p>InnoDB的索引实现，InnoDB有两大类索引：</p><ul><li>聚集索引</li><li>非聚集索引</li></ul><p>InnoDB<strong>聚集索引</strong>的叶子节点存储行记录，因此， InnoDB必须要有，且只有<strong>一个聚集索引</strong>：</p><p>（1）如果表定义了Primary Key，则Primary Key就是聚集索引；</p><p>（2）如果表没有定义Primary Key，则第一个not NULL unique列是聚集索引；</p><p>（3）否则，InnoDB会创建一个隐藏的row-id作为聚集索引；</p></blockquote><p><img src="./MySQL%E7%B4%A2%E5%BC%95%E5%92%8C%E4%BA%8B%E5%8A%A1%E4%BB%8B%E7%BB%8D/001.png" class="lazyload placeholder" data-srcset="./MySQL%E7%B4%A2%E5%BC%95%E5%92%8C%E4%BA%8B%E5%8A%A1%E4%BB%8B%E7%BB%8D/001.png" srcset="https://cdn.jsdelivr.net/gh/volantis-x/cdn-volantis@3/img/placeholder/c617bfd2497fcea598e621413e315c368f8d8e.svg" alt="001.png"></p><p>当为<code>name</code>字段也建立索引，并按照name字段查询行内全部数据时会触发回表。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">explain select * from u_user where name &#x3D; &#39;li&#39;\G</span><br></pre></td></tr></table></figure><p><strong>覆盖索引</strong></p><blockquote><p>当查找的数据只通过一个索引树就可以得到结果，无需回表。</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">explain select id, name from u_user where name &#x3D; &#39;li&#39;\G</span><br></pre></td></tr></table></figure><p><strong>最左匹配</strong></p><blockquote><p>以最左边的为起点任何连续的索引都能匹配上。同时遇到范围查询(&gt;、&lt;、between、like)就会停止匹配。</p></blockquote><p><strong>索引下推</strong></p><blockquote><p>MySQL 5.6引入了索引下推优化，可以在索引遍历过程中，<strong>对索引中包含的字段先做判断，过滤掉不符合条件的记录，减少回表次数</strong>。</p></blockquote><h3 id="索引的匹配方式"><a href="#索引的匹配方式" class="headerlink" title="索引的匹配方式"></a>索引的匹配方式</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"># 员工表</span><br><span class="line">create table staffs (</span><br><span class="line">    id int PRIMARY key auto_increment,</span><br><span class="line">    name VARCHAR(24) not null COMMENT &#39;姓名&#39;,</span><br><span class="line">    age int not null COMMENT &#39;年龄&#39;,</span><br><span class="line">    pos VARCHAR(20) not null COMMENT &#39;职位&#39;,</span><br><span class="line">    add_time TIMESTAMP not null COMMENT &#39;入职时间&#39;</span><br><span class="line">) CHARSET utf8 comment &#39;员工记录表&#39;;</span><br><span class="line"></span><br><span class="line"># 添加组合索引</span><br><span class="line">alter table staffs add index idx_nap(name,age,pos);</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"># 查看索引</span><br><span class="line">mysql&gt; show index from staffs\G</span><br><span class="line">*************************** 1. row ***************************</span><br><span class="line">        Table: staffs</span><br><span class="line">   Non_unique: 0</span><br><span class="line">     Key_name: PRIMARY</span><br><span class="line"> Seq_in_index: 1</span><br><span class="line">  Column_name: id</span><br><span class="line">    Collation: A</span><br><span class="line">  Cardinality: 0</span><br><span class="line">     Sub_part: NULL</span><br><span class="line">       Packed: NULL</span><br><span class="line">         Null:</span><br><span class="line">   Index_type: BTREE</span><br><span class="line">      Comment:</span><br><span class="line">Index_comment:</span><br><span class="line">      Visible: YES</span><br><span class="line">   Expression: NULL</span><br><span class="line">*************************** 2. row ***************************</span><br><span class="line">        Table: staffs</span><br><span class="line">   Non_unique: 1</span><br><span class="line">     Key_name: idx_nap</span><br><span class="line"> Seq_in_index: 1</span><br><span class="line">  Column_name: name</span><br><span class="line">    Collation: A</span><br><span class="line">  Cardinality: 0</span><br><span class="line">     Sub_part: NULL</span><br><span class="line">       Packed: NULL</span><br><span class="line">         Null:</span><br><span class="line">   Index_type: BTREE</span><br><span class="line">      Comment:</span><br><span class="line">Index_comment:</span><br><span class="line">      Visible: YES</span><br><span class="line">   Expression: NULL</span><br><span class="line">*************************** 3. row ***************************</span><br><span class="line">        Table: staffs</span><br><span class="line">   Non_unique: 1</span><br><span class="line">     Key_name: idx_nap</span><br><span class="line"> Seq_in_index: 2</span><br><span class="line">  Column_name: age</span><br><span class="line">    Collation: A</span><br><span class="line">  Cardinality: 0</span><br><span class="line">     Sub_part: NULL</span><br><span class="line">       Packed: NULL</span><br><span class="line">         Null:</span><br><span class="line">   Index_type: BTREE</span><br><span class="line">      Comment:</span><br><span class="line">Index_comment:</span><br><span class="line">      Visible: YES</span><br><span class="line">   Expression: NULL</span><br><span class="line">*************************** 4. row ***************************</span><br><span class="line">        Table: staffs</span><br><span class="line">   Non_unique: 1</span><br><span class="line">     Key_name: idx_nap</span><br><span class="line"> Seq_in_index: 3</span><br><span class="line">  Column_name: pos</span><br><span class="line">    Collation: A</span><br><span class="line">  Cardinality: 0</span><br><span class="line">     Sub_part: NULL</span><br><span class="line">       Packed: NULL</span><br><span class="line">         Null:</span><br><span class="line">   Index_type: BTREE</span><br><span class="line">      Comment:</span><br><span class="line">Index_comment:</span><br><span class="line">      Visible: YES</span><br><span class="line">   Expression: NULL</span><br><span class="line">4 rows in set (0.01 sec)</span><br></pre></td></tr></table></figure><p><strong>全值匹配</strong>：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; explain select * from staffs where name &#x3D; &#39;July&#39; and age &#x3D; &#39;23&#39; and pos&#x3D;&#39;dev&#39;\G</span><br><span class="line">*************************** 1. row ***************************</span><br><span class="line">           id: 1</span><br><span class="line">  select_type: SIMPLE</span><br><span class="line">        table: staffs</span><br><span class="line">   partitions: NULL</span><br><span class="line">         type: ref</span><br><span class="line">possible_keys: idx_nap</span><br><span class="line">          key: idx_nap</span><br><span class="line">      key_len: 140</span><br><span class="line">          ref: const,const,const</span><br><span class="line">         rows: 1</span><br><span class="line">     filtered: 100.00</span><br><span class="line">        Extra: NULL</span><br><span class="line">1 row in set, 1 warning (0.00 sec)</span><br></pre></td></tr></table></figure><blockquote><p>注意<code>key_len</code>, 利用key_len可以推出用到的索引</p><p>140 = { name的varchar(24) + pos的varchar(20) } * 3(utf8字符占三个字节) + int的4 + 每个varchar在存储时会多占用2个字节所以 name + pos (4) 就等于 140</p></blockquote><p><strong>匹配最左前缀</strong>：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; explain select * from staffs where name &#x3D; &#39;July&#39; and age &#x3D; 2\G</span><br><span class="line">*************************** 1. row ***************************</span><br><span class="line">           id: 1</span><br><span class="line">  select_type: SIMPLE</span><br><span class="line">        table: staffs</span><br><span class="line">   partitions: NULL</span><br><span class="line">         type: ref</span><br><span class="line">possible_keys: idx_nap</span><br><span class="line">          key: idx_nap</span><br><span class="line">      key_len: 78 # 24 * 3 + 4 + varchar额外占用的2个字节</span><br><span class="line">          ref: const,const</span><br><span class="line">         rows: 1</span><br><span class="line">     filtered: 100.00</span><br><span class="line">        Extra: NULL</span><br><span class="line">1 row in set, 1 warning (0.00 sec)</span><br></pre></td></tr></table></figure><p><strong>匹配列前缀</strong>：<code>like</code></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"># % 符号在后可以触发索引</span><br><span class="line">mysql&gt; explain select * from staffs where name like &#39;J%&#39; and age &#x3D; 23\G</span><br><span class="line">*************************** 1. row ***************************</span><br><span class="line">           id: 1</span><br><span class="line">  select_type: SIMPLE</span><br><span class="line">        table: staffs</span><br><span class="line">   partitions: NULL</span><br><span class="line">         type: range</span><br><span class="line">possible_keys: idx_nap</span><br><span class="line">          key: idx_nap</span><br><span class="line">      key_len: 78</span><br><span class="line">          ref: NULL</span><br><span class="line">         rows: 1</span><br><span class="line">     filtered: 100.00</span><br><span class="line">        Extra: Using index condition</span><br><span class="line">1 row in set, 1 warning (0.00 sec)</span><br><span class="line"># % 符号在前无法触发索引</span><br><span class="line">mysql&gt; explain select * from staffs where name like &#39;%J%&#39; and age &#x3D; 23\G</span><br><span class="line">*************************** 1. row ***************************</span><br><span class="line">           id: 1</span><br><span class="line">  select_type: SIMPLE</span><br><span class="line">        table: staffs</span><br><span class="line">   partitions: NULL</span><br><span class="line">         type: ALL</span><br><span class="line">possible_keys: NULL</span><br><span class="line">          key: NULL</span><br><span class="line">      key_len: NULL</span><br><span class="line">          ref: NULL</span><br><span class="line">         rows: 1</span><br><span class="line">     filtered: 100.00</span><br><span class="line">        Extra: Using where</span><br><span class="line">1 row in set, 1 warning (0.00 sec)</span><br></pre></td></tr></table></figure><p><strong>匹配范围值</strong>：<code>&gt;</code>,<code>&lt;</code></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; explain select * from staffs where name &gt; &#39;yuxiang&#39;\G</span><br><span class="line">*************************** 1. row ***************************</span><br><span class="line">           id: 1</span><br><span class="line">  select_type: SIMPLE</span><br><span class="line">        table: staffs</span><br><span class="line">   partitions: NULL</span><br><span class="line">         type: range</span><br><span class="line">possible_keys: idx_nap</span><br><span class="line">          key: idx_nap</span><br><span class="line">      key_len: 74</span><br><span class="line">          ref: NULL</span><br><span class="line">         rows: 1</span><br><span class="line">     filtered: 100.00</span><br><span class="line">        Extra: Using index condition</span><br><span class="line">1 row in set, 1 warning (0.00 sec)</span><br></pre></td></tr></table></figure><blockquote><p>当用到 &gt; 或 &lt; 等范围查询时，在范围查询后面的字段将不会使用索引</p></blockquote><h2 id="事务"><a href="#事务" class="headerlink" title="事务"></a>事务</h2><h3 id="事务的基本要素"><a href="#事务的基本要素" class="headerlink" title="事务的基本要素"></a>事务的基本要素</h3><p>1、原子性（Atomicity）：事务开始后所有操作，要么全部做完，要么全部不做，不可能停滞在中间环节。事务执行过程中出错，会回滚到事务开始前的状态，所有的操作就像没有发生一样。也就是说事务是一个不可分割的整体，就像化学中学过的原子，是物质构成的基本单位。</p><p>2、一致性（Consistency）：事务开始前和结束后，数据库的完整性约束没有被破坏 。比如A向B转账，不可能A扣了钱，B却没收到。</p><p>3、隔离性（Isolation）：同一时间，只允许一个事务请求同一数据，不同的事务之间彼此没有任何干扰。比如A正在从一张银行卡中取钱，在A取钱的过程结束前，B不能向这张卡转账。</p><p>4、持久性（Durability）：事务完成后，事务对数据库的所有更新将被保存到数据库，不能回滚。</p><h3 id="事务的并发问题"><a href="#事务的并发问题" class="headerlink" title="事务的并发问题"></a>事务的并发问题</h3><p>1、脏读：事务A读取了事务B更新的数据，然后B回滚操作，那么A读取到的数据是脏数据</p><p>2、不可重复读：事务 A 多次读取同一数据，事务 B 在事务A多次读取的过程中，对数据作了更新并提交，导致事务A多次读取同一数据时，结果 不一致。</p><p>3、幻读：系统管理员A将数据库中所有学生的成绩从具体分数改为ABCDE等级，但是系统管理员B就在这个时候插入了一条具体分数的记录，当系统管理员A改结束后发现还有一条记录没有改过来，就好像发生了幻觉一样，这就叫幻读。</p><h3 id="事务隔离级别"><a href="#事务隔离级别" class="headerlink" title="事务隔离级别"></a>事务隔离级别</h3><table><thead><tr><th>事务隔离级别</th><th>脏读</th><th>不可重复读</th><th>幻读</th></tr></thead><tbody><tr><td>读未提交（read-uncommitted）</td><td>是</td><td>是</td><td>是</td></tr><tr><td>不可重复读（read-committed）</td><td>否</td><td>是</td><td>是</td></tr><tr><td>可重复读（repeatable-read）</td><td>否</td><td>否</td><td>是</td></tr><tr><td>串行化（serializable）</td><td>否</td><td>否</td><td>否</td></tr></tbody></table><p>MySQL默认事务隔离级别。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; show variables like &#39;TRANSACTION_isolation&#39;;</span><br><span class="line">+-----------------------+-----------------+</span><br><span class="line">| Variable_name         | Value           |</span><br><span class="line">+-----------------------+-----------------+</span><br><span class="line">| transaction_isolation | REPEATABLE-READ |</span><br><span class="line">+-----------------------+-----------------+</span><br><span class="line">1 row in set, 1 warning (0.01 sec)&#96;1&#96;</span><br></pre></td></tr></table></figure><h3 id="演示"><a href="#演示" class="headerlink" title="演示"></a>演示</h3><blockquote><p>需要将MySQL的事务提交改为手动提交。</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">set global autocommit&#x3D;0;</span><br></pre></td></tr></table></figure><h4 id="读未提交"><a href="#读未提交" class="headerlink" title="读未提交"></a>读未提交</h4><p>。。。。。。</p>]]></content>
      
      
      <categories>
          
          <category> MySQL </category>
          
          <category> MySQL索引 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> MySQL </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>redis介绍和使用</title>
      <link href="2020/10/18/Redis%E4%BB%8B%E7%BB%8D%E5%92%8C%E4%BD%BF%E7%94%A8/"/>
      <url>2020/10/18/Redis%E4%BB%8B%E7%BB%8D%E5%92%8C%E4%BD%BF%E7%94%A8/</url>
      
        <content type="html"><![CDATA[<p>redis的介绍、安装、使用和Liunx高级命令</p><a id="more"></a><h2 id="环境"><a href="#环境" class="headerlink" title="环境"></a>环境</h2><ul><li>Aliyun CentOS Linux 7</li><li>Redis 5.X</li></ul><h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p><a href="https://redis.io/">Redis</a>是一个开源（BSD许可），内存中的数据结构存储，用作数据库、缓存和消息代理。它支持诸如字符串、哈希、列表、集合、带范围查询的排序集、位图、超日志、带有radius查询和流的地理空间索引等数据结构。Redis内置了复制、Lua脚本、LRU逐出、事务和不同级别的磁盘持久性，并通过Redis Sentinel和Redis Cluster自动分区来提供高可用性。</p><h2 id="下载安装"><a href="#下载安装" class="headerlink" title="下载安装"></a>下载安装</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 安装wget工具</span></span><br><span class="line">yum install wget -y</span><br><span class="line"><span class="meta">#</span><span class="bash"> 下载Redis</span></span><br><span class="line">wget https://download.redis.io/releases/redis-5.0.5.tar.gz</span><br><span class="line"><span class="meta">#</span><span class="bash"> 解压缩</span></span><br><span class="line">tar -zxvf redis-5.0.5.tar.gz</span><br><span class="line">cd redis-5.0.5 &amp;&amp; ls -lh</span><br><span class="line"><span class="meta">#</span><span class="bash"> 此处推荐查看 README.md文件，该文件介绍了Redis如何安装，也可以按照我的操作进行</span></span><br></pre></td></tr></table></figure><p><img src="001.png" class="lazyload placeholder" data-srcset="001.png" srcset="https://cdn.jsdelivr.net/gh/volantis-x/cdn-volantis@3/img/placeholder/c617bfd2497fcea598e621413e315c368f8d8e.svg" alt="redis目录"></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 安装环境，否则可能会编译出错</span></span><br><span class="line">yum install gcc -y</span><br><span class="line"><span class="meta">#</span><span class="bash"> 编译，安装，会默认安装到 /usr/<span class="built_in">local</span>/bin 中</span></span><br><span class="line">make &amp;&amp; make install</span><br><span class="line"><span class="meta">#</span><span class="bash"> 如果编译失败，则使用 make distclean 清楚编译失败的文件</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 进入 redis目录中的 utils目录下，执行 ./install_server.sh 根据问题进行操作即可</span></span><br></pre></td></tr></table></figure><p>验证服务启动状态<code>service redis_6379 status</code> 或 <code>systemctl status redis_6379</code></p><p><img src="002.png" class="lazyload placeholder" data-srcset="002.png" srcset="https://cdn.jsdelivr.net/gh/volantis-x/cdn-volantis@3/img/placeholder/c617bfd2497fcea598e621413e315c368f8d8e.svg" alt="redis status"></p><h2 id="strace使用"><a href="#strace使用" class="headerlink" title="strace使用"></a>strace使用</h2><p><strong>strace</strong> 是 Linux 环境下的一款程序调试工具，用来监察一个应用程序所使用的系统呼叫及它所接收的系统信息。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 安装</span></span><br><span class="line">yum install strace -y</span><br><span class="line"><span class="meta">#</span><span class="bash"> 在 root 目录下创建 stracedir 文件夹</span></span><br><span class="line">cd ~ &amp;&amp; mkdir stracedir</span><br><span class="line"><span class="meta">#</span><span class="bash"> 启动监控 -ff:监控主线程和所有主线程创建的线程    -o:追踪日志输出目录</span></span><br><span class="line">strace -ff -o ~/stracedir/ooxx ./Redis-server</span><br></pre></td></tr></table></figure><p>查看 <code>/root/stracedir</code>文件夹下生成的文件，由名字和线程PID组成。</p><h2 id="连接"><a href="#连接" class="headerlink" title="连接"></a>连接</h2><p>输入<code>redis-cli</code>即可连接</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">[root@ctl ~]# redis-cli -h  # 查看命令帮助，此处列出一部分</span><br><span class="line">redis-cli 5.0.5</span><br><span class="line"></span><br><span class="line">Usage: redis-cli [OPTIONS] [cmd [arg [arg ...]]]</span><br><span class="line">  -h &lt;hostname&gt;      Server hostname (default: 127.0.0.1).</span><br><span class="line">  -p &lt;port&gt;          Server port (default: 6379).</span><br><span class="line">  -s &lt;socket&gt;        Server socket (overrides hostname and port).</span><br><span class="line">  -a &lt;password&gt;      Password to use when connecting to the server.</span><br><span class="line">                     You can also use the REDISCLI_AUTH environment</span><br><span class="line">                     variable to pass this password more safely</span><br><span class="line">                     (if both are used, this argument takes predecence).</span><br><span class="line">  -u &lt;uri&gt;           Server URI.</span><br><span class="line">  -n &lt;db&gt;            Database number.</span><br><span class="line">  --raw              Use raw formatting for replies (default when STDOUT is</span><br><span class="line">                     not a tty).</span><br></pre></td></tr></table></figure><h2 id="redis五大类型"><a href="#redis五大类型" class="headerlink" title="redis五大类型"></a>redis五大类型</h2><p><code>help @[+ tab键]</code> 可查看redis类型的具体操作详解</p><p>key 最大可为 512M</p><h3 id="string"><a href="#string" class="headerlink" title="string"></a>string</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> object  命令</span></span><br><span class="line">Object &lt;ENCODING|FREQ|IDLETIME|REFCOUNT&gt; &lt;key&gt;</span><br><span class="line"></span><br><span class="line">127.0.0.1:6379&gt; get str</span><br><span class="line">&quot;yu&quot;</span><br><span class="line">127.0.0.1:6379&gt; get nu</span><br><span class="line">&quot;2&quot;</span><br><span class="line">127.0.0.1:6379&gt; object encoding str</span><br><span class="line">&quot;embstr&quot;</span><br><span class="line">127.0.0.1:6379&gt; object encoding nu</span><br><span class="line">&quot;int&quot;</span><br></pre></td></tr></table></figure><p>bitmap</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> setbit  命令 对二进制进行操作</span></span><br><span class="line">SETBIT &lt;key&gt; offset value</span><br><span class="line"></span><br><span class="line">127.0.0.1:6379&gt; setbit str 1 1 # 0100 0000</span><br><span class="line">(integer) 0</span><br><span class="line">127.0.0.1:6379&gt; get str</span><br><span class="line">&quot;@&quot;</span><br><span class="line">127.0.0.1:6379&gt; setbit str 7 1 # 0100 0001</span><br><span class="line">(integer) 0</span><br><span class="line">127.0.0.1:6379&gt; get str</span><br><span class="line">&quot;A&quot;</span><br><span class="line">127.0.0.1:6379&gt; setbit str 7 0 </span><br><span class="line">(integer) 1</span><br><span class="line">127.0.0.1:6379&gt; setbit str 6 1 # 0100 0010</span><br><span class="line">(integer) 0</span><br><span class="line">127.0.0.1:6379&gt; get str</span><br><span class="line">&quot;B&quot;</span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> bitcount 命令 对起始字节到结束字节中的二进制位为1的进行统计</span></span><br><span class="line">BITCOUNT key [start end]</span><br><span class="line"></span><br><span class="line">127.0.0.1:6379&gt; get str # 0100 0010 0100 0000</span><br><span class="line">&quot;B@&quot;</span><br><span class="line">127.0.0.1:6379&gt; bitcount str 1 1 </span><br><span class="line">(integer) 1</span><br><span class="line">127.0.0.1:6379&gt; bitcount str 0 1</span><br><span class="line">(integer) 3</span><br><span class="line">127.0.0.1:6379&gt; setbit str 14 1 # 0100 0010 0100 0010</span><br><span class="line">(integer) 0</span><br><span class="line">127.0.0.1:6379&gt; bitcount str 1 1</span><br><span class="line">(integer) 2</span><br><span class="line">127.0.0.1:6379&gt; get str</span><br><span class="line">&quot;BB&quot;</span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> bitpos 命令 获取“起始字节”到“结束字节”的“0”或“1”第一次出现的位置下标 </span></span><br><span class="line">BITPOS key bit [start] [end]</span><br><span class="line"></span><br><span class="line">127.0.0.1:6379&gt; get str # 0100 0010 0100 0010</span><br><span class="line">&quot;BB&quot;</span><br><span class="line">127.0.0.1:6379&gt; bitpos str 0 1 1 </span><br><span class="line">(integer) 8</span><br><span class="line">127.0.0.1:6379&gt; bitpos str 1 1 1</span><br><span class="line">(integer) 9</span><br><span class="line">127.0.0.1:6379&gt; setbit str 9 0</span><br><span class="line">(integer) 1</span><br><span class="line">127.0.0.1:6379&gt; bitpos str 1 1 1</span><br><span class="line">(integer) 14</span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> bitop 命令  </span></span><br><span class="line">BITOP operation destkey key [key ...]</span><br><span class="line">operation = [and|or]</span><br><span class="line"></span><br><span class="line">127.0.0.1:6379&gt; setbit k1 1 1</span><br><span class="line">(integer) 0</span><br><span class="line">127.0.0.1:6379&gt; setbit k1 7 1</span><br><span class="line">(integer) 0</span><br><span class="line">127.0.0.1:6379&gt; get k1</span><br><span class="line">&quot;A&quot;</span><br><span class="line">127.0.0.1:6379&gt; setbit k2 1 1</span><br><span class="line">(integer) 0</span><br><span class="line">127.0.0.1:6379&gt; setbit k2 6 1</span><br><span class="line">(integer) 0</span><br><span class="line">127.0.0.1:6379&gt; get k2</span><br><span class="line">&quot;B&quot;</span><br><span class="line">127.0.0.1:6379&gt; bitop and andkey k1 k2 # 0100 0001 and 0100 0010 = 0100 0000</span><br><span class="line">(integer) 1</span><br><span class="line">127.0.0.1:6379&gt; get andkey</span><br><span class="line">&quot;@&quot;</span><br><span class="line">127.0.0.1:6379&gt; bitop or orkey k1 k2 # 0100 0001 or 0100 0010 = 0100 0011</span><br><span class="line">(integer) 1</span><br><span class="line">127.0.0.1:6379&gt; get orkey</span><br><span class="line">&quot;C&quot;</span><br></pre></td></tr></table></figure><p>场景解读 &gt;</p><p>incr<code>接口调用次数</code>  可以利用最大值 - 次数，来指定次数</p><p>incr <code>秒杀场景</code></p><p>bitmap <code>统计用户</code>一段时间内的登录情况 </p><p>列：bitmap 用户名 [365 1]，[25 1]即为 一年中的第25天和365天登录了</p><p> bitmap 20201019 用户名id 1，即为该用户在20201019号这一天有登录</p><p> bitmap 20201020 用户名id 1，即为该用户在20201020号这一天有登录</p><p>之后使用 bitop or 19-20 20201019 20201020来统计某时间段内的<code>活跃用户</code></p><h3 id="list"><a href="#list" class="headerlink" title="list"></a>list</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; help @list</span><br><span class="line"></span><br><span class="line">  BLPOP key [key ...] timeout</span><br><span class="line">  summary: Remove and get the first element in a list, or block until one is available</span><br><span class="line">  since: 2.0.0</span><br><span class="line"></span><br><span class="line">  BRPOP key [key ...] timeout</span><br><span class="line">  summary: Remove and get the last element in a list, or block until one is available</span><br><span class="line">  since: 2.0.0</span><br><span class="line"></span><br><span class="line">  BRPOPLPUSH source destination timeout</span><br><span class="line">  summary: Pop a value from a list, push it to another list and return it; or block until one is available</span><br><span class="line">  since: 2.2.0</span><br><span class="line"></span><br><span class="line">  LINDEX key index</span><br><span class="line">  summary: Get an element from a list by its index</span><br><span class="line">  since: 1.0.0</span><br><span class="line"></span><br><span class="line">  LINSERT key BEFORE|AFTER pivot value</span><br><span class="line">  summary: Insert an element before or after another element in a list</span><br><span class="line">  since: 2.2.0</span><br><span class="line"></span><br><span class="line">  LLEN key</span><br><span class="line">  summary: Get the length of a list</span><br><span class="line">  since: 1.0.0</span><br><span class="line"></span><br><span class="line">  LPOP key</span><br><span class="line">  summary: Remove and get the first element in a list</span><br><span class="line">  since: 1.0.0</span><br><span class="line"></span><br><span class="line">  LPUSH key value [value ...]</span><br><span class="line">  summary: Prepend one or multiple values to a list</span><br><span class="line">  since: 1.0.0</span><br><span class="line"></span><br><span class="line">  LPUSHX key value</span><br><span class="line">  summary: Prepend a value to a list, only if the list exists</span><br><span class="line">  since: 2.2.0</span><br><span class="line"></span><br><span class="line">  LRANGE key start stop</span><br><span class="line">  summary: Get a range of elements from a list</span><br><span class="line">  since: 1.0.0</span><br><span class="line"></span><br><span class="line">  LREM key count value</span><br><span class="line">  summary: Remove elements from a list</span><br><span class="line">  since: 1.0.0</span><br><span class="line"></span><br><span class="line">  LSET key index value</span><br><span class="line">  summary: Set the value of an element in a list by its index</span><br><span class="line">  since: 1.0.0</span><br><span class="line"></span><br><span class="line">  LTRIM key start stop</span><br><span class="line">  summary: Trim a list to the specified range</span><br><span class="line">  since: 1.0.0</span><br><span class="line"></span><br><span class="line">  RPOP key</span><br><span class="line">  summary: Remove and get the last element in a list</span><br><span class="line">  since: 1.0.0</span><br><span class="line"></span><br><span class="line">  RPOPLPUSH source destination</span><br><span class="line">  summary: Remove the last element in a list, prepend it to another list and return it</span><br><span class="line">  since: 1.2.0</span><br><span class="line"></span><br><span class="line">  RPUSH key value [value ...]</span><br><span class="line">  summary: Append one or multiple values to a list</span><br><span class="line">  since: 1.0.0</span><br><span class="line"></span><br><span class="line">  RPUSHX key value</span><br><span class="line">  summary: Append a value to a list, only if the list exists</span><br><span class="line">  since: 2.2.0</span><br></pre></td></tr></table></figure><p>场景解读 &gt;</p><p>可以当：栈、队列、数组</p><p>ltrim<code>热评论</code></p><h3 id="hash"><a href="#hash" class="headerlink" title="hash"></a>hash</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; help @hash</span><br><span class="line"></span><br><span class="line">  HDEL key field [field ...]</span><br><span class="line">  summary: Delete one or more hash fields</span><br><span class="line">  since: 2.0.0</span><br><span class="line"></span><br><span class="line">  HEXISTS key field</span><br><span class="line">  summary: Determine if a hash field exists</span><br><span class="line">  since: 2.0.0</span><br><span class="line"></span><br><span class="line">  HGET key field</span><br><span class="line">  summary: Get the value of a hash field</span><br><span class="line">  since: 2.0.0</span><br><span class="line"></span><br><span class="line">  HGETALL key</span><br><span class="line">  summary: Get all the fields and values in a hash</span><br><span class="line">  since: 2.0.0</span><br><span class="line"></span><br><span class="line">  HINCRBY key field increment</span><br><span class="line">  summary: Increment the integer value of a hash field by the given number</span><br><span class="line">  since: 2.0.0</span><br><span class="line"></span><br><span class="line">  HINCRBYFLOAT key field increment</span><br><span class="line">  summary: Increment the float value of a hash field by the given amount</span><br><span class="line">  since: 2.6.0</span><br><span class="line"></span><br><span class="line">  HKEYS key</span><br><span class="line">  summary: Get all the fields in a hash</span><br><span class="line">  since: 2.0.0</span><br><span class="line"></span><br><span class="line">  HLEN key</span><br><span class="line">  summary: Get the number of fields in a hash</span><br><span class="line">  since: 2.0.0</span><br><span class="line"></span><br><span class="line">  HMGET key field [field ...]</span><br><span class="line">  summary: Get the values of all the given hash fields</span><br><span class="line">  since: 2.0.0</span><br><span class="line"></span><br><span class="line">  HMSET key field value [field value ...]</span><br><span class="line">  summary: Set multiple hash fields to multiple values</span><br><span class="line">  since: 2.0.0</span><br><span class="line"></span><br><span class="line">  HSCAN key cursor [MATCH pattern] [COUNT count]</span><br><span class="line">  summary: Incrementally iterate hash fields and associated values</span><br><span class="line">  since: 2.8.0</span><br><span class="line"></span><br><span class="line">  HSET key field value</span><br><span class="line">  summary: Set the string value of a hash field</span><br><span class="line">  since: 2.0.0</span><br><span class="line"></span><br><span class="line">  HSETNX key field value</span><br><span class="line">  summary: Set the value of a hash field, only if the field does not exist</span><br><span class="line">  since: 2.0.0</span><br><span class="line"></span><br><span class="line">  HSTRLEN key field</span><br><span class="line">  summary: Get the length of the value of a hash field</span><br><span class="line">  since: 3.2.0</span><br><span class="line"></span><br><span class="line">  HVALS key</span><br><span class="line">  summary: Get all the values in a hash</span><br><span class="line">  since: 2.0.0</span><br></pre></td></tr></table></figure><p>场景解读 &gt;</p><p><code>商品详情页</code>利用<code>filed</code>聚合数据</p><h3 id="set"><a href="#set" class="headerlink" title="set"></a>set</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; help @set</span><br><span class="line"></span><br><span class="line">  SADD key member [member ...]</span><br><span class="line">  summary: Add one or more members to a set</span><br><span class="line">  since: 1.0.0</span><br><span class="line"></span><br><span class="line">  SCARD key</span><br><span class="line">  summary: Get the number of members in a set</span><br><span class="line">  since: 1.0.0</span><br><span class="line"></span><br><span class="line">  SDIFF key [key ...]</span><br><span class="line">  summary: Subtract multiple sets</span><br><span class="line">  since: 1.0.0</span><br><span class="line"></span><br><span class="line">  SDIFFSTORE destination key [key ...]</span><br><span class="line">  summary: Subtract multiple sets and store the resulting set in a key</span><br><span class="line">  since: 1.0.0</span><br><span class="line"></span><br><span class="line">  SINTER key [key ...]</span><br><span class="line">  summary: Intersect multiple sets</span><br><span class="line">  since: 1.0.0</span><br><span class="line"></span><br><span class="line">  SINTERSTORE destination key [key ...]</span><br><span class="line">  summary: Intersect multiple sets and store the resulting set in a key</span><br><span class="line">  since: 1.0.0</span><br><span class="line"></span><br><span class="line">  SISMEMBER key member</span><br><span class="line">  summary: Determine if a given value is a member of a set</span><br><span class="line">  since: 1.0.0</span><br><span class="line"></span><br><span class="line">  SMEMBERS key</span><br><span class="line">  summary: Get all the members in a set</span><br><span class="line">  since: 1.0.0</span><br><span class="line"></span><br><span class="line">  SMOVE source destination member</span><br><span class="line">  summary: Move a member from one set to another</span><br><span class="line">  since: 1.0.0</span><br><span class="line"></span><br><span class="line">  SPOP key [count]</span><br><span class="line">  summary: Remove and return one or multiple random members from a set</span><br><span class="line">  since: 1.0.0</span><br><span class="line"></span><br><span class="line">  SRANDMEMBER key [count] # count&gt;0时，返回集合会去重，count&lt;0时，返回集合不会去重</span><br><span class="line">  summary: Get one or multiple random members from a set</span><br><span class="line">  since: 1.0.0</span><br><span class="line"></span><br><span class="line">  SREM key member [member ...]</span><br><span class="line">  summary: Remove one or more members from a set</span><br><span class="line">  since: 1.0.0</span><br><span class="line"></span><br><span class="line">  SSCAN key cursor [MATCH pattern] [COUNT count]</span><br><span class="line">  summary: Incrementally iterate Set elements</span><br><span class="line">  since: 2.8.0</span><br><span class="line"></span><br><span class="line">  SUNION key [key ...]</span><br><span class="line">  summary: Add multiple sets</span><br><span class="line">  since: 1.0.0</span><br><span class="line"></span><br><span class="line">  SUNIONSTORE destination key [key ...]</span><br><span class="line">  summary: Add multiple sets and store the resulting set in a key</span><br><span class="line">  since: 1.0.0</span><br></pre></td></tr></table></figure><p>场景解读 &gt;</p><p><code>抽奖</code> spop 随机算出一个</p><p><code>简单推荐系统</code> 利用两个set集合进行并集或交集的操作；sdiff </p><h3 id="sorted-set"><a href="#sorted-set" class="headerlink" title="sorted_set"></a>sorted_set</h3><p>特点： 去重、有序</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; help @sorted_set</span><br><span class="line"></span><br><span class="line">  ZADD key [NX|XX] [CH] [INCR] score member [score member ...]</span><br><span class="line">  summary: Add one or more members to a sorted set, or update its score if it already exists</span><br><span class="line">  since: 1.2.0</span><br><span class="line"></span><br><span class="line">  ZCARD key</span><br><span class="line">  summary: Get the number of members in a sorted set</span><br><span class="line">  since: 1.2.0</span><br><span class="line"></span><br><span class="line">  ZCOUNT key min max</span><br><span class="line">  summary: Count the members in a sorted set with scores within the given values</span><br><span class="line">  since: 2.0.0</span><br><span class="line"></span><br><span class="line">  ZINCRBY key increment member</span><br><span class="line">  summary: Increment the score of a member in a sorted set</span><br><span class="line">  since: 1.2.0</span><br><span class="line"></span><br><span class="line">  ZINTERSTORE destination numkeys key [key ...] [WEIGHTS weight] [AGGREGATE SUM|MIN|MAX]</span><br><span class="line">  summary: Intersect multiple sorted sets and store the resulting sorted set in a new key</span><br><span class="line">  since: 2.0.0</span><br><span class="line"></span><br><span class="line">  ZLEXCOUNT key min max</span><br><span class="line">  summary: Count the number of members in a sorted set between a given lexicographical range</span><br><span class="line">  since: 2.8.9</span><br><span class="line"></span><br><span class="line">  ZPOPMAX key [count]</span><br><span class="line">  summary: Remove and return members with the highest scores in a sorted set</span><br><span class="line">  since: 5.0.0</span><br><span class="line"></span><br><span class="line">  ZPOPMIN key [count]</span><br><span class="line">  summary: Remove and return members with the lowest scores in a sorted set</span><br><span class="line">  since: 5.0.0</span><br><span class="line"></span><br><span class="line">  ZRANGE key start stop [WITHSCORES]</span><br><span class="line">  summary: Return a range of members in a sorted set, by index</span><br><span class="line">  since: 1.2.0</span><br><span class="line"></span><br><span class="line">  ZRANGEBYLEX key min max [LIMIT offset count]</span><br><span class="line">  summary: Return a range of members in a sorted set, by lexicographical range</span><br><span class="line">  since: 2.8.9</span><br><span class="line"></span><br><span class="line">  ZRANGEBYSCORE key min max [WITHSCORES] [LIMIT offset count]</span><br><span class="line">  summary: Return a range of members in a sorted set, by score</span><br><span class="line">  since: 1.0.5</span><br><span class="line"></span><br><span class="line">  ZRANK key member # 返回排名</span><br><span class="line">  summary: Determine the index of a member in a sorted set</span><br><span class="line">  since: 2.0.0</span><br><span class="line"></span><br><span class="line">  ZREM key member [member ...]</span><br><span class="line">  summary: Remove one or more members from a sorted set</span><br><span class="line">  since: 1.2.0</span><br><span class="line"></span><br><span class="line">  ZREMRANGEBYLEX key min max</span><br><span class="line">  summary: Remove all members in a sorted set between the given lexicographical range</span><br><span class="line">  since: 2.8.9</span><br><span class="line"></span><br><span class="line">  ZREMRANGEBYRANK key start stop</span><br><span class="line">  summary: Remove all members in a sorted set within the given indexes</span><br><span class="line">  since: 2.0.0</span><br><span class="line"></span><br><span class="line">  ZREMRANGEBYSCORE key min max</span><br><span class="line">  summary: Remove all members in a sorted set within the given scores</span><br><span class="line">  since: 1.2.0</span><br><span class="line"></span><br><span class="line">  ZREVRANGE key start stop [WITHSCORES]</span><br><span class="line">  summary: Return a range of members in a sorted set, by index, with scores ordered from high to low</span><br><span class="line">  since: 1.2.0</span><br><span class="line"></span><br><span class="line">  ZREVRANGEBYLEX key max min [LIMIT offset count]</span><br><span class="line">  summary: Return a range of members in a sorted set, by lexicographical range, ordered from higher to lower strings.</span><br><span class="line">  since: 2.8.9</span><br><span class="line"></span><br><span class="line">  ZREVRANGEBYSCORE key max min [WITHSCORES] [LIMIT offset count]</span><br><span class="line">  summary: Return a range of members in a sorted set, by score, with scores ordered from high to low</span><br><span class="line">  since: 2.2.0</span><br><span class="line"></span><br><span class="line">  ZREVRANK key member</span><br><span class="line">  summary: Determine the index of a member in a sorted set, with scores ordered from high to low</span><br><span class="line">  since: 2.0.0</span><br><span class="line"></span><br><span class="line">  ZSCAN key cursor [MATCH pattern] [COUNT count]</span><br><span class="line">  summary: Incrementally iterate sorted sets elements and associated scores</span><br><span class="line">  since: 2.8.0</span><br><span class="line"></span><br><span class="line">  ZSCORE key member</span><br><span class="line">  summary: Get the score associated with the given member in a sorted set</span><br><span class="line">  since: 1.2.0</span><br><span class="line"></span><br><span class="line">  ZUNIONSTORE destination numkeys key [key ...] [WEIGHTS weight] [AGGREGATE SUM|MIN|MAX]</span><br><span class="line">  summary: Add multiple sorted sets and store the resulting sorted set in a new key</span><br><span class="line">  since: 2.0.0</span><br></pre></td></tr></table></figure><p>场景解读 &gt;</p><p><code>排行榜</code></p><h2 id="通用命令"><a href="#通用命令" class="headerlink" title="通用命令"></a>通用命令</h2><p>key的时效性控制</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 为指定key设置有效期</span></span><br><span class="line">expire key seconds</span><br><span class="line">pexpire key milliseconds</span><br><span class="line">expireat key timestamp</span><br><span class="line">pexpireat key milliseconds-timestamp</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 获取key的有效时间</span></span><br><span class="line">ttl key # 返回-2 不存在，返回-1 存在，返回key的剩余时间</span><br><span class="line">pttl key</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 切换key从时效性转为永久性</span></span><br><span class="line">persist key</span><br></pre></td></tr></table></figure><p>数据库操作</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 选择数据库 0-15</span></span><br><span class="line">select &lt;index&gt;</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 数据移动</span></span><br><span class="line">move key &lt;dbindex&gt;</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 查看当前库有多少个key</span></span><br><span class="line">dbsize</span><br></pre></td></tr></table></figure><h2 id="持久化"><a href="#持久化" class="headerlink" title="持久化"></a>持久化</h2><h3 id="RDB"><a href="#RDB" class="headerlink" title="RDB"></a>RDB</h3><h3 id="AOF"><a href="#AOF" class="headerlink" title="AOF"></a>AOF</h3>]]></content>
      
      
      <categories>
          
          <category> redis </category>
          
          <category> redis使用 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> redis </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>MySQL之PXC集群</title>
      <link href="2020/10/14/MySQL%E4%B9%8BPXC%E9%9B%86%E7%BE%A4/"/>
      <url>2020/10/14/MySQL%E4%B9%8BPXC%E9%9B%86%E7%BE%A4/</url>
      
        <content type="html"><![CDATA[<p>Docker环境下，部署MySQL之PXC集群的操作</p><a id="more"></a><h2 id="环境"><a href="#环境" class="headerlink" title="环境"></a>环境</h2><ul><li>Aliyun CentOS Linux 7</li><li>Docker Version 19.03.12</li><li>Docker Image percona/percona-xtradb-cluster:5.7</li></ul><h2 id="实践"><a href="#实践" class="headerlink" title="实践"></a>实践</h2><h3 id="1-下载MySQL镜像"><a href="#1-下载MySQL镜像" class="headerlink" title="1.下载MySQL镜像"></a>1.下载MySQL镜像</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker pull percona/percona-xtradb-cluster:5.7</span><br></pre></td></tr></table></figure><h3 id="2-重命名镜像"><a href="#2-重命名镜像" class="headerlink" title="2.重命名镜像"></a>2.重命名镜像</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker tag percona/percona-xtradb-cluster:5.7 pxc:5.7</span><br></pre></td></tr></table></figure><h3 id="3-创建数据卷"><a href="#3-创建数据卷" class="headerlink" title="3.创建数据卷"></a>3.创建数据卷</h3><p><strong>注</strong>： <strong><em>pxc</em></strong> 只支持数据卷，不支持挂载目录</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">docker volume create v1</span><br><span class="line">docker volume create v1</span><br><span class="line">docker volume create v1</span><br><span class="line"><span class="meta">#</span><span class="bash"> 查看数据卷创建情况</span></span><br><span class="line">docker volume ls</span><br></pre></td></tr></table></figure><h3 id="4-创建网络，用于-pxc集群"><a href="#4-创建网络，用于-pxc集群" class="headerlink" title="4.创建网络，用于 pxc集群"></a>4.创建网络，用于 <strong>pxc</strong>集群</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">docker network create pxc-network</span><br><span class="line"><span class="meta">#</span><span class="bash"> 查看Docker 网络</span></span><br><span class="line">docker network ls</span><br></pre></td></tr></table></figure><h3 id="5-运行第一个MySQL实例节点"><a href="#5-运行第一个MySQL实例节点" class="headerlink" title="5.运行第一个MySQL实例节点"></a>5.运行第一个MySQL实例节点</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">docker run -di --name=pn1 \</span><br><span class="line">--net=pxc-network -p 9000:3306 \</span><br><span class="line">-v v1:/var/lib/mysql --privileged \</span><br><span class="line">-e MYSQL_ROOT_PASSWORD=123456 \</span><br><span class="line">-e CLUSTER_NAME=cluster1 \</span><br><span class="line">-e XTRABACKUP_PASSWORD=123456 pxc:5.7</span><br></pre></td></tr></table></figure><p>查看是否创建成功</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker logs pn1</span><br></pre></td></tr></table></figure><p>出现下面情况测启动成功 </p><p><code>2020-10-15T01:39:47.933208Z 0 [Note] InnoDB: Buffer pool(s) load completed at 201015  1:39:47</code></p><h3 id="6-运行第二个MySQL实例节点"><a href="#6-运行第二个MySQL实例节点" class="headerlink" title="6.运行第二个MySQL实例节点"></a>6.运行第二个MySQL实例节点</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">docker run -di --name=pn2 \</span><br><span class="line">--net=pxc-network -p 9001:3306 \</span><br><span class="line">-v v2:/var/lib/mysql --privileged \</span><br><span class="line">-e MYSQL_ROOT_PASSWORD=123456 \</span><br><span class="line">-e CLUSTER_NAME=cluster1 \</span><br><span class="line">-e XTRABACKUP_PASSWORD=123456 \</span><br><span class="line">-e CLUSTER_JOIN=pn1 pxc:5.7 </span><br></pre></td></tr></table></figure><p>从<strong>第二个节点开始</strong>，就需要增加<code>cluster_join</code> 来指定与其进行数据同步的节点。当 <code>PXC</code>集群中存在两个节点以上之后就没有主节点的概念了。集群中最后一个退出的节点就会变为主节点，在<code>/var/lib/mysql/grastate.dat</code> 文件中属性 <code>safe_to_bootstrap</code> 的值 会从 <code>0</code> 被设置为 <code>1</code> 表示该节点是主节点。</p><h3 id="7-运行第三个MySQL实例节点"><a href="#7-运行第三个MySQL实例节点" class="headerlink" title="7.运行第三个MySQL实例节点"></a>7.运行第三个MySQL实例节点</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">docker run -di --name=pn3 \</span><br><span class="line">--net=pxc-network -p 9002:3306 \</span><br><span class="line">-v v3:/var/lib/mysql --privileged \</span><br><span class="line">-e MYSQL_ROOT_PASSWORD=123456 \</span><br><span class="line">-e CLUSTER_NAME=cluster1 \</span><br><span class="line">-e XTRABACKUP_PASSWORD=123456 \</span><br><span class="line">-e CLUSTER_JOIN=pn2 pxc:5.7</span><br></pre></td></tr></table></figure><p>这次我们指定<code>cluster_join=pn2</code>,可以证明<strong>当集群中有两个以上的节点时，就没有主节点的概念了</strong>。</p><h3 id="8-进入-pn1节点"><a href="#8-进入-pn1节点" class="headerlink" title="8.进入 pn1节点"></a>8.进入 <code>pn1</code>节点</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">docker exec -it pn1 /bin/bash</span><br><span class="line"><span class="meta">#</span><span class="bash"> 连接mysql</span></span><br><span class="line">mysql -uroot -p123456</span><br></pre></td></tr></table></figure><h3 id="9-查看状态"><a href="#9-查看状态" class="headerlink" title="9.查看状态"></a>9.查看状态</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; show status like &quot;wsrep%&quot;;</span><br><span class="line">+----------------------------------+-------------------------------------------------------+</span><br><span class="line">| Variable_name                    | Value                                                 |</span><br><span class="line">+----------------------------------+-------------------------------------------------------+</span><br><span class="line">| wsrep_local_state_uuid           | 81380d49-0dd6-11eb-aa93-028f13d687c0                  |</span><br><span class="line">| wsrep_protocol_version           | 9                                                     |</span><br><span class="line">| wsrep_last_applied               | 25                                                    |</span><br><span class="line">| wsrep_last_committed             | 25                                                    |</span><br><span class="line">| wsrep_replicated                 | 0                                                     |</span><br><span class="line">| wsrep_replicated_bytes           | 0                                                     |</span><br><span class="line">| wsrep_repl_keys                  | 0                                                     |</span><br><span class="line">| wsrep_repl_keys_bytes            | 0                                                     |</span><br><span class="line">| wsrep_repl_data_bytes            | 0                                                     |</span><br><span class="line">| wsrep_repl_other_bytes           | 0                                                     |</span><br><span class="line">| wsrep_received                   | 4                                                     |</span><br><span class="line">| wsrep_received_bytes             | 656                                                   |</span><br><span class="line">| wsrep_local_commits              | 0                                                     |</span><br><span class="line">| wsrep_local_cert_failures        | 0                                                     |</span><br><span class="line">| wsrep_local_replays              | 0                                                     |</span><br><span class="line">| wsrep_local_send_queue           | 0                                                     |</span><br><span class="line">| wsrep_local_send_queue_max       | 1                                                     |</span><br><span class="line">| wsrep_local_send_queue_min       | 0                                                     |</span><br><span class="line">| wsrep_local_send_queue_avg       | 0.000000                                              |</span><br><span class="line">| wsrep_local_recv_queue           | 0                                                     |</span><br><span class="line">| wsrep_local_recv_queue_max       | 2                                                     |</span><br><span class="line">| wsrep_local_recv_queue_min       | 0                                                     |</span><br><span class="line">| wsrep_local_recv_queue_avg       | 0.250000                                              |</span><br><span class="line">| wsrep_local_cached_downto        | 0                                                     |</span><br><span class="line">| wsrep_flow_control_paused_ns     | 0                                                     |</span><br><span class="line">| wsrep_flow_control_paused        | 0.000000                                              |</span><br><span class="line">| wsrep_flow_control_sent          | 0                                                     |</span><br><span class="line">| wsrep_flow_control_recv          | 0                                                     |</span><br><span class="line">| wsrep_flow_control_interval      | [ 173, 173 ]                                          |</span><br><span class="line">| wsrep_flow_control_interval_low  | 173                                                   |</span><br><span class="line">| wsrep_flow_control_interval_high | 173                                                   |</span><br><span class="line">| wsrep_flow_control_status        | OFF                                                   |</span><br><span class="line">| wsrep_cert_deps_distance         | 0.000000                                              |</span><br><span class="line">| wsrep_apply_oooe                 | 0.000000                                              |</span><br><span class="line">| wsrep_apply_oool                 | 0.000000                                              |</span><br><span class="line">| wsrep_apply_window               | 0.000000                                              |</span><br><span class="line">| wsrep_commit_oooe                | 0.000000                                              |</span><br><span class="line">| wsrep_commit_oool                | 0.000000                                              |</span><br><span class="line">| wsrep_commit_window              | 0.000000                                              |</span><br><span class="line">| wsrep_local_state                | 4                                                     |</span><br><span class="line">| wsrep_local_state_comment        | Synced                                                |</span><br><span class="line">| wsrep_cert_index_size            | 0                                                     |</span><br><span class="line">| wsrep_cert_bucket_count          | 22                                                    |</span><br><span class="line">| wsrep_gcache_pool_size           | 1320                                                  |</span><br><span class="line">| wsrep_causal_reads               | 0                                                     |</span><br><span class="line">| wsrep_cert_interval              | 0.000000                                              |</span><br><span class="line">| wsrep_open_transactions          | 0                                                     |</span><br><span class="line">| wsrep_open_connections           | 0                                                     |</span><br><span class="line">| wsrep_ist_receive_status         |                                                       |</span><br><span class="line">| wsrep_ist_receive_seqno_start    | 0                                                     |</span><br><span class="line">| wsrep_ist_receive_seqno_current  | 0                                                     |</span><br><span class="line">| wsrep_ist_receive_seqno_end      | 0                                                     |</span><br><span class="line">| wsrep_incoming_addresses         | a3faa8d63239:3306,254c483efa2d:3306,4745baee323f:3306 |</span><br><span class="line">| wsrep_cluster_weight             | 3                                                     |</span><br><span class="line">| wsrep_desync_count               | 0                                                     |</span><br><span class="line">| wsrep_evs_delayed                |                                                       |</span><br><span class="line">| wsrep_evs_evict_list             |                                                       |</span><br><span class="line">| wsrep_evs_repl_latency           | 0&#x2F;0&#x2F;0&#x2F;0&#x2F;0                                             |</span><br><span class="line">| wsrep_evs_state                  | OPERATIONAL                                           |</span><br><span class="line">| wsrep_gcomm_uuid                 | 8b7301c0-0dd6-11eb-b180-07c4552aa3e6                  |</span><br><span class="line">| wsrep_cluster_conf_id            | 3                                                     |</span><br><span class="line">| wsrep_cluster_size               | 3                                                     |</span><br><span class="line">| wsrep_cluster_state_uuid         | 81380d49-0dd6-11eb-aa93-028f13d687c0                  |</span><br><span class="line">| wsrep_cluster_status             | Primary                                               |</span><br><span class="line">| wsrep_connected                  | ON                                                    |</span><br><span class="line">| wsrep_local_bf_aborts            | 0                                                     |</span><br><span class="line">| wsrep_local_index                | 1                                                     |</span><br><span class="line">| wsrep_provider_name              | Galera                                                |</span><br><span class="line">| wsrep_provider_vendor            | Codership Oy &lt;info@codership.com&gt;                     |</span><br><span class="line">| wsrep_provider_version           | 3.45(ra60e019)                                        |</span><br><span class="line">| wsrep_ready                      | ON                                                    |</span><br><span class="line">+----------------------------------+-------------------------------------------------------+</span><br><span class="line">71 rows in set (0.03 sec)</span><br></pre></td></tr></table></figure><p><code>wsrep_incoming_addresses</code> 属性 对应的就是三台机器的实例ID。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">| wsrep_incoming_addresses   |   a3faa8d63239:3306,254c483efa2d:3306,4745baee323f:3306 |</span><br></pre></td></tr></table></figure><p>集群完整性检查：</p><table><thead><tr><th align="left">属性</th><th>含义</th></tr></thead><tbody><tr><td align="left">wsrep_cluster_state_uuid</td><td>在集群所有节点的值应该是相同的,有不同值的节点,说明其没有连接入集群.</td></tr><tr><td align="left">wsrep_cluster_conf_id</td><td>正常情况下所有节点上该值是一样的.如果值不同,说明该节点被临时”分区”了.当节点之间网络连接恢复 的时候应该会恢复一样的值.</td></tr><tr><td align="left">wsrep_cluster_size</td><td>如果这个值跟预期的节点数一致,则所有的集群节点已经连接.</td></tr><tr><td align="left">wsrep_cluster_status</td><td>集群组成的状态.如果不为”Primary”,说明出现”分区”或是”split-brain”脑裂状况.</td></tr></tbody></table><p>节点状态检查：</p><table><thead><tr><th>属性</th><th>含义</th></tr></thead><tbody><tr><td>wsrep_ready</td><td>该值为 ON,则说明可以接受 SQL 负载.如果为 Off,则需要检查 wsrep_connected</td></tr><tr><td>wsrep_connected</td><td>如果该值为 Off,且 wsrep_ready 的值也为 Off,则说明该节点没有连接到集群.(可能是 wsrep_cluster_address 或 wsrep_cluster_name 等配置错造成的.具体错误需要查看错误日志)</td></tr><tr><td>wsrep_local_state_comment</td><td>如果 wsrep_connected 为 On,但 wsrep_ready 为 OFF,则可以从该项查看原因</td></tr></tbody></table><p>复制健康检查:</p><table><thead><tr><th>属性</th><th>含义</th></tr></thead><tbody><tr><td>wsrep_flow_control_paused</td><td>表示复制停止了多长时间.即表明集群因为 Slave 延迟而慢的程度.值为 0~1,越靠近 0 越好,值为 1 表示 复制完全停止.可优化 wsrep_slave_threads 的值来改善</td></tr><tr><td>wsrep_cert_deps_distance</td><td>有多少事务可以并行应用处理.wsrep_slave_threads 设置的值不应该高出该值太多</td></tr><tr><td>wsrep_flow_control_sent</td><td>表示该节点已经停止复制了多少次</td></tr><tr><td>*wsrep_local_recv_queue_avg</td><td>表示 slave 事务队列的平均长度.slave 瓶颈的预兆. 最慢的节点的 wsrep_flow_control_sent 和 wsrep_local_recv_queue_avg 这两个值最高.这两个值较低的话,相对更好</td></tr></tbody></table><p>检测慢网络问题：</p><table><thead><tr><th>属性</th><th>含义</th></tr></thead><tbody><tr><td>wsrep_local_send_queue_avg</td><td>网络瓶颈的预兆.如果这个值比较高的话,可能存在网络瓶颈</td></tr></tbody></table><p>冲突或死锁的数目:</p><table><thead><tr><th>属性</th><th>含义</th></tr></thead><tbody><tr><td>wsrep_last_committed</td><td>最后提交的事务数目</td></tr><tr><td>wsrep_local_cert_failures 和 wsrep_local_bf_aborts</td><td>回滚,检测到的冲突数目</td></tr></tbody></table><h2 id="集群同步验证"><a href="#集群同步验证" class="headerlink" title="集群同步验证"></a>集群同步验证</h2><p>验证集群搭建。</p><ol><li>在节点 <code>pn1</code>创建数据库<code>pxc_test</code></li></ol><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; create database pxc_test;                         </span><br><span class="line">Query OK, 1 row affected (0.05 sec)</span><br></pre></td></tr></table></figure><ol start="2"><li>在节点<code>pn2</code>中查看数据库<code>psc_test</code></li></ol><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; show databases;</span><br><span class="line">+--------------------+</span><br><span class="line">| Database           |</span><br><span class="line">+--------------------+</span><br><span class="line">| information_schema |</span><br><span class="line">| mysql              |</span><br><span class="line">| performance_schema |</span><br><span class="line">| pxc_test           |</span><br><span class="line">| sys                |</span><br><span class="line">| test               |</span><br><span class="line">+--------------------+</span><br><span class="line">6 rows in set (0.02 sec)</span><br></pre></td></tr></table></figure><ol start="3"><li>在节点<code>pn2</code>上创建<code>sys_user</code>表</li></ol><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; use pxc_test;</span><br><span class="line">Database changed</span><br><span class="line">mysql&gt; create table sys_user ( id int primary key, name varchar(255));</span><br><span class="line">Query OK, 0 rows affected (0.03 sec)</span><br></pre></td></tr></table></figure><ol start="4"><li>在节点<code>pn3</code>上查看表</li></ol><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; show tables;</span><br><span class="line">+--------------------+</span><br><span class="line">| Tables_in_pxc_test |</span><br><span class="line">+--------------------+</span><br><span class="line">| sys_user           |</span><br><span class="line">+--------------------+</span><br><span class="line">1 row in set (0.00 sec)</span><br></pre></td></tr></table></figure><ol start="5"><li>在<code>sys_user</code>上创建数据</li></ol><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; insert into sys_user values(1,&quot;yuxiang&quot;);</span><br><span class="line">Query OK, 1 row affected (0.01 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; select * from sys_user;</span><br><span class="line">+----+---------+</span><br><span class="line">| id | name    |</span><br><span class="line">+----+---------+</span><br><span class="line">|  1 | yuxiang |</span><br><span class="line">+----+---------+</span><br><span class="line">1 row in set (0.01 sec)</span><br></pre></td></tr></table></figure><ol start="6"><li>在<code>pn1</code>和<code>pn2</code>上查看数据</li></ol><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select * from sys_user;</span><br><span class="line">+----+---------+</span><br><span class="line">| id | name    |</span><br><span class="line">+----+---------+</span><br><span class="line">|  1 | yuxiang |</span><br><span class="line">+----+---------+</span><br><span class="line">1 row in set (0.02 sec)</span><br></pre></td></tr></table></figure><p><strong>可以看到三个节点数据正常同步，并且都可读可写。</strong></p><h2 id="新增集群节点操作"><a href="#新增集群节点操作" class="headerlink" title="新增集群节点操作"></a>新增集群节点操作</h2><p>当数据库不够用时，我们通常需要增加数据库节点来分担压力，我们来演示一下新增节点的操作。</p><ol><li>创建数据卷</li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker volume create v4</span><br></pre></td></tr></table></figure><ol start="2"><li>运行第四个MySQL实例容器</li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">docker run -di --name=pn4 \</span><br><span class="line">--net=pxc-network -p 9003:3306 \</span><br><span class="line">-v v4:/var/lib/mysql --privileged \</span><br><span class="line">-e MYSQL_ROOT_PASSWORD=123456 \</span><br><span class="line">-e CLUSTER_NAME=cluster1 \</span><br><span class="line">-e XTRABACKUP_PASSWORD=123456 \</span><br><span class="line">-e CLUSTER_JOIN=pn3 pxc:5.7</span><br></pre></td></tr></table></figure><p>这次<code>cluster_join</code>指定的容器是<code>pn3</code>。</p><ol start="3"><li>进入<code>pn4</code>节点，查看数据</li></ol><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; show databases;</span><br><span class="line">+--------------------+</span><br><span class="line">| Database           |</span><br><span class="line">+--------------------+</span><br><span class="line">| information_schema |</span><br><span class="line">| mysql              |</span><br><span class="line">| performance_schema |</span><br><span class="line">| pxc_test           |</span><br><span class="line">| sys                |</span><br><span class="line">| test               |</span><br><span class="line">+--------------------+</span><br><span class="line">6 rows in set (0.03 sec)</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; show tables;</span><br><span class="line">+--------------------+</span><br><span class="line">| Tables_in_pxc_test |</span><br><span class="line">+--------------------+</span><br><span class="line">| sys_user           |</span><br><span class="line">+--------------------+</span><br><span class="line">1 row in set (0.00 sec)</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select * from sys_user;</span><br><span class="line">+----+---------+</span><br><span class="line">| id | name    |</span><br><span class="line">+----+---------+</span><br><span class="line">|  1 | yuxiang |</span><br><span class="line">+----+---------+</span><br><span class="line">1 row in set (0.01 sec)</span><br></pre></td></tr></table></figure><ol start="4"><li>在<code>pn4</code>上添加数据</li></ol><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; insert into sys_user values(2,&quot;pxc_pn4&quot;);</span><br><span class="line">Query OK, 1 row affected (0.31 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; select * from sys_user;</span><br><span class="line">+----+---------+</span><br><span class="line">| id | name    |</span><br><span class="line">+----+---------+</span><br><span class="line">|  1 | yuxiang |</span><br><span class="line">|  2 | pxc_pn4 |</span><br><span class="line">+----+---------+</span><br><span class="line">2 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure><p><strong>在其他节点查看，数据也都同步了。</strong></p><h2 id="模拟宕机操作"><a href="#模拟宕机操作" class="headerlink" title="模拟宕机操作"></a>模拟宕机操作</h2><ol><li>将<code>pn4</code>关闭</li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker stop pn4</span><br></pre></td></tr></table></figure><ol start="2"><li>在<code>pn1</code>中插入数据</li></ol><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; insert into sys_user values(3, &quot;down_online&quot;);</span><br><span class="line">Query OK, 1 row affected (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; select * from sys_user;</span><br><span class="line">+----+-------------+</span><br><span class="line">| id | name        |</span><br><span class="line">+----+-------------+</span><br><span class="line">|  1 | yuxiang     |</span><br><span class="line">|  2 | pxc_pn4     |</span><br><span class="line">|  3 | down_online |</span><br><span class="line">+----+-------------+</span><br><span class="line">3 rows in set (0.21 sec)</span><br></pre></td></tr></table></figure><ol start="3"><li>重新启动<code>pn4</code></li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker start pn4</span><br></pre></td></tr></table></figure><ol start="4"><li>查看数据</li></ol><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select * from sys_user;</span><br><span class="line">+----+-------------+</span><br><span class="line">| id | name        |</span><br><span class="line">+----+-------------+</span><br><span class="line">|  1 | yuxiang     |</span><br><span class="line">|  2 | pxc_pn4     |</span><br><span class="line">|  3 | down_online |</span><br><span class="line">+----+-------------+</span><br><span class="line">3 rows in set (0.01 sec)</span><br></pre></td></tr></table></figure><p>数据依然同步上了</p><hr><p><strong>ps</strong>：当所有节点全部宕机时，需从<code>pn1</code>节点启动，如果<code>pn1</code>不是最后一个宕机的，他的<code>volume</code>下的<code>grastate.dat</code>中的<code>safe_to_bootstrap: 0</code>,则无法启动，需要手动将该属性值改为<code>safe_to_bootstrap: 1</code></p>]]></content>
      
      
      <categories>
          
          <category> MySQL </category>
          
          <category> PXC集群 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Docker </tag>
            
            <tag> MySQL </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>zookeeper分布式锁</title>
      <link href="2020/09/29/Zookeeper%E5%88%86%E5%B8%83%E5%BC%8F%E9%94%81/"/>
      <url>2020/09/29/Zookeeper%E5%88%86%E5%B8%83%E5%BC%8F%E9%94%81/</url>
      
        <content type="html"><![CDATA[<p>Zookeeper实现分布式锁实战</p><a id="more"></a><h2 id="介绍"><a href="#介绍" class="headerlink" title="介绍"></a>介绍</h2><p><a href="https://zookeeper.apache.org/">Zookeeper</a>是一个分布式的，开放源码的分布式应用程序协调服务，是Google的Chubby一个开源的实现，是Hadoop和Hbase的重要组件。它是一个为分布式应用提供一致性服务的软件，提供的功能包括：配置维护、域名服务、分布式同步、组服务等。</p><h2 id="下载安装"><a href="#下载安装" class="headerlink" title="下载安装"></a>下载安装</h2><h3 id="进入Zookeeper官网"><a href="#进入Zookeeper官网" class="headerlink" title="进入Zookeeper官网"></a>进入Zookeeper官网</h3><p><img src="01.png" class="lazyload placeholder" data-srcset="01.png" srcset="https://cdn.jsdelivr.net/gh/volantis-x/cdn-volantis@3/img/placeholder/c617bfd2497fcea598e621413e315c368f8d8e.svg" alt="zookeeper官网"></p><h3 id="下载最新版，并解压缩"><a href="#下载最新版，并解压缩" class="headerlink" title="下载最新版，并解压缩"></a>下载最新版，并解压缩</h3><p><img src="02.png" class="lazyload placeholder" data-srcset="02.png" srcset="https://cdn.jsdelivr.net/gh/volantis-x/cdn-volantis@3/img/placeholder/c617bfd2497fcea598e621413e315c368f8d8e.svg" alt="下载3.6.2版本"></p><p><img src="03.png" class="lazyload placeholder" data-srcset="03.png" srcset="https://cdn.jsdelivr.net/gh/volantis-x/cdn-volantis@3/img/placeholder/c617bfd2497fcea598e621413e315c368f8d8e.svg" alt="解压缩后目录"></p><h2 id="启动"><a href="#启动" class="headerlink" title="启动"></a>启动</h2><div class="note idea"><p>在安装目录下 <strong>conf目录</strong> 中将<strong>zoo_sample.cfg</strong> 复制一份，命名为 <strong>zoo.cfg</strong></p></div><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 将**zoo.cfg**中的 dataDir属性值 修改为 &quot;安装路径&quot; + &quot;/data&quot;</span></span><br><span class="line"><span class="attr">dataDir</span>=<span class="string">D://zookeeper//apache-zookeeper-3.6.2-bin//data</span></span><br></pre></td></tr></table></figure><p><img src="04.png" class="lazyload placeholder" data-srcset="04.png" srcset="https://cdn.jsdelivr.net/gh/volantis-x/cdn-volantis@3/img/placeholder/c617bfd2497fcea598e621413e315c368f8d8e.svg" alt="修改配置文件"></p><div class="note idea"><p>启动 ./bin目录下 <strong>zkServer.cmd</strong> <strong>zkCli.cmd</strong> 命令</p></div><p><img src="05.png" class="lazyload placeholder" data-srcset="05.png" srcset="https://cdn.jsdelivr.net/gh/volantis-x/cdn-volantis@3/img/placeholder/c617bfd2497fcea598e621413e315c368f8d8e.svg" alt="启动zookeeper"></p><h2 id="基本操作"><a href="#基本操作" class="headerlink" title="基本操作"></a>基本操作</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> create 结点 值 (创建结点和值，默认创建永久结点)</span></span><br><span class="line">create /service-user 8001</span><br><span class="line"><span class="meta">#</span><span class="bash"> ls 结点 (查看结点下其他结点)</span></span><br><span class="line">ls /service-user</span><br><span class="line"><span class="meta">#</span><span class="bash"> <span class="built_in">set</span> 结点 (更改结点信息)</span></span><br><span class="line">set /service-user &#123;&quot;port&quot;:80,&quot;url&quot;:&quot;http://yuxiangai.cn&quot;&#125;</span><br><span class="line"><span class="meta">#</span><span class="bash"> get 结点 (得到对应结点的值)</span></span><br><span class="line">get /servie-user</span><br><span class="line"><span class="meta">#</span><span class="bash"> delete 结点 (删除结点和对应值)</span></span><br><span class="line">delete /servie-user</span><br></pre></td></tr></table></figure><div class="note blue"><p>zookeeper的结点默认是永久的，即当你断开连接后，你所创建的结点依然存在，我们可以在创建时 加入参数 <strong>-e</strong> 来指定为临时结点，当断开连接时，创建的结点会被清除</p></div><div class="note blue"><p>zookeeper的结点默认是唯一的，即相同名称的结点只有一个，我们可以加 <strong>-s</strong> 来给结点增加顺序，看下图</p></div><p><img src="06.png" class="lazyload placeholder" data-srcset="06.png" srcset="https://cdn.jsdelivr.net/gh/volantis-x/cdn-volantis@3/img/placeholder/c617bfd2497fcea598e621413e315c368f8d8e.svg" alt="-s 参数演示"></p><h2 id="代码实现"><a href="#代码实现" class="headerlink" title="代码实现"></a>代码实现</h2><div class="note blue"><p>创建Maven项目 ，在Pom.xml文件中添加依赖</p></div><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.zookeeper<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>zookeeper<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.6.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.101tec<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>zkclient<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>0.11<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure><div class="note idea"><ol><li>定义接口</li></ol></div><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.yuxiang.adl.lock;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">ZKLock</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 加锁</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">lock</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 释放锁</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">unlock</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><div class="note idea"><ol start="2"><li>定义抽象类</li></ol></div><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.yuxiang.adl.lock;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.I0Itec.zkclient.ZkClient;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.CountDownLatch;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">ZKAbstractTemplateLock</span> <span class="keyword">implements</span> <span class="title">ZKLock</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">static</span> <span class="keyword">final</span> String ZK_SERVER = <span class="string">&quot;localhost:2181&quot;</span>;</span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> ZK_TIMEOUT = <span class="number">45</span> * <span class="number">1000</span>;</span><br><span class="line">    <span class="keyword">protected</span> ZkClient client = <span class="keyword">new</span> ZkClient(ZK_SERVER, ZK_TIMEOUT);</span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">static</span> String PATH = <span class="string">&quot;/service-order&quot;</span>;</span><br><span class="line">    <span class="keyword">protected</span> CountDownLatch countDownLatch = <span class="keyword">null</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">lock</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (tryZKLock()) &#123;</span><br><span class="line">            System.out.println(Thread.currentThread().getName() + <span class="string">&quot;\t 占有锁成功&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            waitZkLock();</span><br><span class="line">            lock();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">unlock</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (client != <span class="keyword">null</span>) &#123;</span><br><span class="line">            client.close();</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(Thread.currentThread().getName() + <span class="string">&quot;\t 释放锁成功&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"><span class="comment">// 尝试加锁</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">abstract</span> <span class="keyword">boolean</span> <span class="title">tryZKLock</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="comment">// 加锁失败则等待</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title">waitZkLock</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><div class="note idea"><ol start="3"><li>定义实现类</li></ol></div><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.yuxiang.adl.lock;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.I0Itec.zkclient.IZkDataListener;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.CountDownLatch;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ZKDistributedLock</span> <span class="keyword">extends</span> <span class="title">ZKAbstractTemplateLock</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">boolean</span> <span class="title">tryZKLock</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            client.createEphemeral(PATH);</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">waitZkLock</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        IZkDataListener iZkDataListener = <span class="keyword">new</span> IZkDataListener() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">handleDataChange</span><span class="params">(String s, Object o)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line"></span><br><span class="line">            &#125;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">handleDataDeleted</span><span class="params">(String s)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">                <span class="keyword">if</span> (countDownLatch != <span class="keyword">null</span>) &#123;</span><br><span class="line">                    countDownLatch.countDown();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line"></span><br><span class="line">        client.subscribeDataChanges(PATH, iZkDataListener);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (client.exists(PATH)) &#123;</span><br><span class="line">            <span class="comment">// 如果存在该节点，只能等着</span></span><br><span class="line">             countDownLatch = <span class="keyword">new</span> CountDownLatch(<span class="number">1</span>);</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                countDownLatch.await();</span><br><span class="line">            &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        client.unsubscribeDataChanges(PATH, iZkDataListener);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><div class="note idea"><ol start="4"><li>生成订单工具类</li></ol></div><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.yuxiang.adl.util;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">OrderNumCreateUtil</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">int</span> number = <span class="number">0</span>;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getOrderNumber</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;\t 生成订单号： &quot;</span> + (++number);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><div class="note"><p>idea,5. 订单生成服务</p></div><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.yuxiang.adl.service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.yuxiang.adl.lock.ZKDistributedLock;</span><br><span class="line"><span class="keyword">import</span> com.yuxiang.adl.lock.ZKLock;</span><br><span class="line"><span class="keyword">import</span> com.yuxiang.adl.util.OrderNumCreateUtil;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">OrderService</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> OrderNumCreateUtil orderNumCreateUtil = <span class="keyword">new</span> OrderNumCreateUtil();</span><br><span class="line">    <span class="keyword">private</span> ZKLock zkLock = <span class="keyword">new</span> ZKDistributedLock();</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">getOrderNumber</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        zkLock.lock();</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            System.out.println(orderNumCreateUtil.getOrderNumber());</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            zkLock.unlock();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><div class="note idea"><ol start="6"><li>Main方法</li></ol></div><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.yuxiang.adl;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.yuxiang.adl.service.OrderService;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ZookeeperMain</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">20</span>; i++) &#123;</span><br><span class="line">            <span class="keyword">new</span> Thread(() -&gt; &#123;</span><br><span class="line">                <span class="keyword">new</span> OrderService().getOrderNumber();</span><br><span class="line">            &#125;, String.valueOf(i)).start();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><div class="note red"><ol start="7"><li>类关系图</li></ol></div><p><img src="07.png" class="lazyload placeholder" data-srcset="07.png" srcset="https://cdn.jsdelivr.net/gh/volantis-x/cdn-volantis@3/img/placeholder/c617bfd2497fcea598e621413e315c368f8d8e.svg" alt="关系"></p>]]></content>
      
      
      <categories>
          
          <category> zookeeper </category>
          
          <category> zookeeper分布式锁 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> zookeeper </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Gradle的下载安装与配置</title>
      <link href="2020/09/22/Gradle%E7%9A%84%E4%B8%8B%E8%BD%BD%E5%AE%89%E8%A3%85%E4%B8%8E%E9%85%8D%E7%BD%AE/"/>
      <url>2020/09/22/Gradle%E7%9A%84%E4%B8%8B%E8%BD%BD%E5%AE%89%E8%A3%85%E4%B8%8E%E9%85%8D%E7%BD%AE/</url>
      
        <content type="html"><![CDATA[<p>Maven的下载安装、配置及简单使用</p><a id="more"></a><h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p><a href="https://gradle.org/">Gradle</a>是是一个基于Apache Ant和Apache Maven概念的项目自动化构建开源工具。它使用一种基于Groovy的特定领域语言(DSL)来声明项目设置，目前也增加了基于Kotlin语言的kotlin-based DSL，抛弃了基于XML的各种繁琐配置。</p><p>面向Java应用为主。当前其支持的语言限于Java、Groovy、Kotlin和Scala，计划未来将支持更多的语言。</p><h2 id="下载"><a href="#下载" class="headerlink" title="下载"></a>下载</h2><div class="note blue"><p><strong>下载页面</strong> : <a href="https://services.gradle.org/distributions">https://services.gradle.org/distributions</a> 下载gradle-x.x-bin.zip(发行版)</p></div><p><img src="001.png" class="lazyload placeholder" data-srcset="001.png" srcset="https://cdn.jsdelivr.net/gh/volantis-x/cdn-volantis@3/img/placeholder/c617bfd2497fcea598e621413e315c368f8d8e.svg" alt="下载界面"></p><p>可以自选版本，我这里选择之前的版本 <strong>gradle-5.4-bin.zip</strong> ，解压缩，放到指定目录。</p><p><img src="002.png" class="lazyload placeholder" data-srcset="002.png" srcset="https://cdn.jsdelivr.net/gh/volantis-x/cdn-volantis@3/img/placeholder/c617bfd2497fcea598e621413e315c368f8d8e.svg" alt="gradle目录"></p><h2 id="配置环境变量"><a href="#配置环境变量" class="headerlink" title="配置环境变量"></a>配置环境变量</h2><div class="note blue"><p>在 此电脑 -&gt; 属性 -&gt; 高级系统设置 -&gt; 环境变量 -&gt; 系统变量 -&gt; 新建</p></div><div class="note "><p>变量值为Gradle的文件安装位置</p></div><p><img src="003.png" class="lazyload placeholder" data-srcset="003.png" srcset="https://cdn.jsdelivr.net/gh/volantis-x/cdn-volantis@3/img/placeholder/c617bfd2497fcea598e621413e315c368f8d8e.svg" alt="编辑系统变量"></p><div class="note blue"><p>修改path变量，将Gradle的bin 【%GRADLE_HOME%\bin】添加到变量之中</p></div><p><img src="004.png" class="lazyload placeholder" data-srcset="004.png" srcset="https://cdn.jsdelivr.net/gh/volantis-x/cdn-volantis@3/img/placeholder/c617bfd2497fcea598e621413e315c368f8d8e.svg" alt="配置path变量"></p><div class="note blue"><p>在命令窗口中输出 【gradle -v】查看是否安装成功</p></div><p><img src="005.png" class="lazyload placeholder" data-srcset="005.png" srcset="https://cdn.jsdelivr.net/gh/volantis-x/cdn-volantis@3/img/placeholder/c617bfd2497fcea598e621413e315c368f8d8e.svg" alt="验证"></p><h2 id="配置本地仓库和镜像加速"><a href="#配置本地仓库和镜像加速" class="headerlink" title="配置本地仓库和镜像加速"></a>配置本地仓库和镜像加速</h2><div class="note blue"><p>Gradle第一次下载文件需要到远程仓库下载，这样很慢，我们可以在本地配置一个仓库，这样第二次直接在本地加载，速度飕飕的。</p></div><div class="note "><p>还是在 此电脑 -&gt; 属性 -&gt; 高级系统设置 -&gt; 环境变量 -&gt; 系统变量 -&gt; 新建</p></div><p><img src="006.png" class="lazyload placeholder" data-srcset="006.png" srcset="https://cdn.jsdelivr.net/gh/volantis-x/cdn-volantis@3/img/placeholder/c617bfd2497fcea598e621413e315c368f8d8e.svg" alt="配置本地仓库"></p><div class="note blue"><p>在Gradle安装目录下的init.d文件中新建文件 <strong>init.gradle</strong> 输入以下内容：</p></div><figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">allprojects</span> &#123;</span><br><span class="line">    <span class="keyword">repositories</span> &#123;</span><br><span class="line">        maven &#123; url <span class="string">&#x27;file:///D:/gradlerepository&#x27;</span>&#125;</span><br><span class="line">        maven &#123; name <span class="string">&quot;Alibaba&quot;</span> ; url <span class="string">&quot;https://maven.aliyun.com/repository/public&quot;</span> &#125;</span><br><span class="line">mavenLocal()</span><br><span class="line">        maven &#123; name <span class="string">&quot;Bstek&quot;</span> ; url <span class="string">&quot;http://nexus.bsdn.org/content/groups/public/&quot;</span> &#125;</span><br><span class="line">        mavenCentral()</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">buildscript</span> &#123; </span><br><span class="line">        <span class="keyword">repositories</span> &#123; </span><br><span class="line">            maven &#123; name <span class="string">&quot;Alibaba&quot;</span> ; url <span class="string">&#x27;https://maven.aliyun.com/repository/public&#x27;</span> &#125;</span><br><span class="line">            maven &#123; name <span class="string">&quot;Bstek&quot;</span> ; url <span class="string">&#x27;http://nexus.bsdn.org/content/groups/public/&#x27;</span> &#125;</span><br><span class="line">            maven &#123; name <span class="string">&quot;M2&quot;</span> ; url <span class="string">&#x27;https://plugins.gradle.org/m2/&#x27;</span> &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="IntelliJ-IDEA配置Gradle"><a href="#IntelliJ-IDEA配置Gradle" class="headerlink" title="IntelliJ IDEA配置Gradle"></a>IntelliJ IDEA配置Gradle</h2><div class="note blue"><p>选择 file -&gt; setting 搜索 gradle</p></div><p><img src="007.png" class="lazyload placeholder" data-srcset="007.png" srcset="https://cdn.jsdelivr.net/gh/volantis-x/cdn-volantis@3/img/placeholder/c617bfd2497fcea598e621413e315c368f8d8e.svg" alt="idea 配置 gradle"></p><div class="note blue"><p>测试 创建Gradle项目</p></div><ol><li>file -&gt; new -&gt; Project ,选择Gradle</li></ol><p><img src="008.png" class="lazyload placeholder" data-srcset="008.png" srcset="https://cdn.jsdelivr.net/gh/volantis-x/cdn-volantis@3/img/placeholder/c617bfd2497fcea598e621413e315c368f8d8e.svg"></p><ol start="2"><li>填写项目名和 groupid、artifactid, version, 点击 Finish</li></ol><p><img src="009.png" class="lazyload placeholder" data-srcset="009.png" srcset="https://cdn.jsdelivr.net/gh/volantis-x/cdn-volantis@3/img/placeholder/c617bfd2497fcea598e621413e315c368f8d8e.svg"></p><ol start="3"><li>添加 <strong>build.gradle</strong>文件中添加Spring 依赖，测试运行Spring项目</li></ol><figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">group</span> <span class="string">&#x27;com.yuxiang&#x27;</span></span><br><span class="line">version <span class="string">&#x27;1.0-SNAPSHOT&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">sourceCompatibility</span> = <span class="number">1.8</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">repositories</span> &#123;</span><br><span class="line">    mavenLocal()</span><br><span class="line">    mavenCentral()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">dependencies</span> &#123;</span><br><span class="line">    testCompile <span class="keyword">group</span>: <span class="string">&#x27;junit&#x27;</span>, name: <span class="string">&#x27;junit&#x27;</span>, version: <span class="string">&#x27;4.12&#x27;</span></span><br><span class="line">    <span class="comment">// https://mvnrepository.com/artifact/org.springframework/spring-context</span></span><br><span class="line">    <span class="keyword">compile</span> <span class="keyword">group</span>: <span class="string">&#x27;org.springframework&#x27;</span>, name: <span class="string">&#x27;spring-context&#x27;</span>, version: <span class="string">&#x27;5.2.5.RELEASE&#x27;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><div class="note idea"><p>主类</p></div><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.yuxiang;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.yuxiang.service.BaseService;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.AnnotationConfigApplicationContext;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.ComponentScan;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SpringMain</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        AnnotationConfigApplicationContext context</span><br><span class="line">                = <span class="keyword">new</span> AnnotationConfigApplicationContext(ServiceConfig.class);</span><br><span class="line"></span><br><span class="line">        BaseService baseService = (BaseService) context.getBean(<span class="string">&quot;baseService&quot;</span>);</span><br><span class="line"></span><br><span class="line">        Integer integer = baseService.show(<span class="number">10</span>);</span><br><span class="line">        System.out.println(integer);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@ComponentScan(&quot;com.yuxiang&quot;)</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ServiceConfig</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><div class="note idea"><p>接口</p></div><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.yuxiang.service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">BaseService</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function">Integer <span class="title">show</span><span class="params">(Integer value)</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><div class="note idea"><p>实现类</p></div><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.yuxiang.service.impl;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.yuxiang.service.BaseService;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Component(&quot;baseService&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BaseServiceImpl</span> <span class="keyword">implements</span> <span class="title">BaseService</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Integer <span class="title">show</span><span class="params">(Integer value)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> value * value;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><div class="note red"><p>运行结果</p></div><p><img src="010.png" class="lazyload placeholder" data-srcset="010.png" srcset="https://cdn.jsdelivr.net/gh/volantis-x/cdn-volantis@3/img/placeholder/c617bfd2497fcea598e621413e315c368f8d8e.svg" alt="运行结果"></p>]]></content>
      
      
      <categories>
          
          <category> 项目构建 </category>
          
          <category> Gradle </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Gradle </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>go语言之框架Gin的简单使用</title>
      <link href="2020/07/10/Go%E8%AF%AD%E8%A8%80%E4%B9%8B%E6%A1%86%E6%9E%B6Gin%E7%9A%84%E7%AE%80%E5%8D%95%E4%BD%BF%E7%94%A8/"/>
      <url>2020/07/10/Go%E8%AF%AD%E8%A8%80%E4%B9%8B%E6%A1%86%E6%9E%B6Gin%E7%9A%84%E7%AE%80%E5%8D%95%E4%BD%BF%E7%94%A8/</url>
      
        <content type="html"><![CDATA[<p>go语言之框架Gin的简单使用</p><a id="more"></a><h2 id="环境"><a href="#环境" class="headerlink" title="环境"></a>环境</h2><ul><li>GoLang SDK 1.14</li></ul><h2 id="实践"><a href="#实践" class="headerlink" title="实践"></a>实践</h2><h4 id="创建项目"><a href="#创建项目" class="headerlink" title="创建项目"></a>创建项目</h4><p><img src="001.png" class="lazyload placeholder" data-srcset="001.png" srcset="https://cdn.jsdelivr.net/gh/volantis-x/cdn-volantis@3/img/placeholder/c617bfd2497fcea598e621413e315c368f8d8e.svg" alt="创建项目"></p><h4 id="在go-mod中引入gin依赖"><a href="#在go-mod中引入gin依赖" class="headerlink" title="在go.mod中引入gin依赖"></a>在go.mod中引入gin依赖</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">module &quot;go-gin-projectall&quot;</span><br><span class="line"></span><br><span class="line">go 1.14</span><br><span class="line"></span><br><span class="line">require github.com&#x2F;gin-gonic&#x2F;gin v1.6.3</span><br></pre></td></tr></table></figure><h4 id="简单例子"><a href="#简单例子" class="headerlink" title="简单例子"></a>简单例子</h4><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;github.com/gin-gonic/gin&quot;</span></span><br><span class="line"><span class="comment">// 第一种方式</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">hello</span><span class="params">(c *gin.Context)</span></span>  &#123;</span><br><span class="line">c.JSON(<span class="number">200</span>, gin.H&#123;</span><br><span class="line"><span class="string">&quot;message&quot;</span>: <span class="string">&quot;Hello &quot;</span>,</span><br><span class="line">&#125;)</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">g := gin.Default()</span><br><span class="line"><span class="comment">// 第二种方式</span></span><br><span class="line">g.GET(<span class="string">&quot;/&quot;</span>, <span class="function"><span class="keyword">func</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">c.JSON(<span class="number">200</span>, gin.H&#123;</span><br><span class="line"><span class="string">&quot;message&quot;</span>: <span class="string">&quot;Hello World&quot;</span>,</span><br><span class="line">&#125;)</span><br><span class="line">&#125;)</span><br><span class="line">g.GET(<span class="string">&quot;/hello&quot;</span>, hello)</span><br><span class="line"></span><br><span class="line">g.Run(<span class="string">&quot;:8666&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>启动访问测试</p><p><img src="002.png" class="lazyload placeholder" data-srcset="002.png" srcset="https://cdn.jsdelivr.net/gh/volantis-x/cdn-volantis@3/img/placeholder/c617bfd2497fcea598e621413e315c368f8d8e.svg" alt="url(/)"></p><p><img src="003.png" class="lazyload placeholder" data-srcset="003.png" srcset="https://cdn.jsdelivr.net/gh/volantis-x/cdn-volantis@3/img/placeholder/c617bfd2497fcea598e621413e315c368f8d8e.svg" alt="url(/hello)"></p><h4 id="Resultful风格"><a href="#Resultful风格" class="headerlink" title="Resultful风格"></a>Resultful风格</h4><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> (</span><br><span class="line"><span class="string">&quot;github.com/gin-gonic/gin&quot;</span></span><br><span class="line"><span class="string">&quot;net/http&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">g := gin.Default()</span><br><span class="line"></span><br><span class="line">g.GET(<span class="string">&quot;/get&quot;</span>, <span class="function"><span class="keyword">func</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">c.JSON(<span class="number">200</span>, gin.H&#123;</span><br><span class="line"><span class="string">&quot;message&quot;</span>: <span class="string">&quot;Get Request url=/get&quot;</span>,</span><br><span class="line">&#125;)</span><br><span class="line">&#125;)</span><br><span class="line">g.POST(<span class="string">&quot;/post&quot;</span>, <span class="function"><span class="keyword">func</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">c.JSON(<span class="number">200</span>, gin.H&#123;</span><br><span class="line"><span class="string">&quot;message&quot;</span>: <span class="string">&quot;Post Request url=/post&quot;</span>,</span><br><span class="line">&#125;)</span><br><span class="line">&#125;)</span><br><span class="line">g.DELETE(<span class="string">&quot;/delete&quot;</span>, <span class="function"><span class="keyword">func</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">c.JSON(<span class="number">200</span>, gin.H&#123;</span><br><span class="line"><span class="string">&quot;message&quot;</span>: <span class="string">&quot;Delete Request url=/delete&quot;</span>,</span><br><span class="line">&#125;)</span><br><span class="line">&#125;)</span><br><span class="line">g.PUT(<span class="string">&quot;/put&quot;</span>, <span class="function"><span class="keyword">func</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">c.JSON(<span class="number">200</span>, gin.H&#123;</span><br><span class="line"><span class="string">&quot;message&quot;</span>: <span class="string">&quot;Put Request url=/put&quot;</span>,</span><br><span class="line">&#125;)</span><br><span class="line">&#125;)</span><br><span class="line">    <span class="comment">// 匹配该路径的任何请求</span></span><br><span class="line">g.Any(<span class="string">&quot;/any&quot;</span>, <span class="function"><span class="keyword">func</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line"><span class="keyword">switch</span> c.Request.Method &#123;</span><br><span class="line">        <span class="comment">// 注意大写</span></span><br><span class="line"><span class="keyword">case</span> <span class="string">&quot;GET&quot;</span>:</span><br><span class="line">c.JSON(<span class="number">200</span>, gin.H&#123;<span class="string">&quot;message&quot;</span>: <span class="string">&quot;url=/any method=get&quot;</span>&#125;)</span><br><span class="line"><span class="keyword">case</span> http.MethodPost:</span><br><span class="line">c.JSON(<span class="number">200</span>, gin.H&#123;<span class="string">&quot;message&quot;</span>: <span class="string">&quot;url=/any method=Post&quot;</span>&#125;)</span><br><span class="line">&#125;</span><br><span class="line">c.JSON(http.StatusOK, gin.H&#123;</span><br><span class="line"><span class="string">&quot;method&quot;</span>: <span class="string">&quot;Any&quot;</span>,</span><br><span class="line">&#125;)</span><br><span class="line">&#125;)</span><br><span class="line"><span class="comment">// 当没有找到匹配路径时触发</span></span><br><span class="line">g.NoRoute(<span class="function"><span class="keyword">func</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">c.JSON(http.StatusNotFound,gin.H&#123;<span class="string">&quot;message&quot;</span>: <span class="string">&quot;Not Found&quot;</span>&#125;)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">g.Run(<span class="string">&quot;:8666&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="路由组"><a href="#路由组" class="headerlink" title="路由组"></a>路由组</h4><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> (</span><br><span class="line"><span class="string">&quot;github.com/gin-gonic/gin&quot;</span></span><br><span class="line"><span class="string">&quot;net/http&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    </span><br><span class="line">g := gin.Default()</span><br><span class="line">    </span><br><span class="line">    authGroup := g.Group(<span class="string">&quot;/auth&quot;</span>, <span class="function"><span class="keyword">func</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line"><span class="comment">// 当组内路径匹配时 会触发该方法</span></span><br><span class="line">c.JSON(http.StatusOK, gin.H&#123;<span class="string">&quot;message&quot;</span>: <span class="string">&quot;url=/auth &quot;</span>&#125;)</span><br><span class="line">&#125;)</span><br><span class="line"><span class="comment">// 方便阅读，用一对&#123;&#125;包裹起来</span></span><br><span class="line">&#123;</span><br><span class="line">        <span class="comment">// 访问路径 /auth/token</span></span><br><span class="line">authGroup.GET(<span class="string">&quot;/token&quot;</span>, <span class="function"><span class="keyword">func</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">c.JSON(http.StatusOK, gin.H&#123;<span class="string">&quot;message&quot;</span>: <span class="string">&quot;Get ok&quot;</span>&#125;)</span><br><span class="line">&#125;)</span><br><span class="line">        <span class="comment">// 访问路径 /auth/token</span></span><br><span class="line">authGroup.POST(<span class="string">&quot;/token&quot;</span>, <span class="function"><span class="keyword">func</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">c.JSON(http.StatusOK, gin.H&#123;<span class="string">&quot;message&quot;</span>: <span class="string">&quot;Post ok&quot;</span>&#125;)</span><br><span class="line">&#125;)</span><br><span class="line">&#125;</span><br><span class="line">    </span><br><span class="line">    g.Run(<span class="string">&quot;:8666&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="获取上传参数"><a href="#获取上传参数" class="headerlink" title="获取上传参数"></a>获取上传参数</h4><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> (</span><br><span class="line"><span class="string">&quot;fmt&quot;</span></span><br><span class="line"><span class="string">&quot;github.com/gin-gonic/gin&quot;</span></span><br><span class="line"><span class="string">&quot;path&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">// UserInfo 用户信息实体</span></span><br><span class="line"><span class="keyword">type</span> UserInfo <span class="keyword">struct</span> &#123;</span><br><span class="line">Username <span class="keyword">string</span> <span class="string">`form:&quot;username&quot;, json:&quot;username&quot;`</span></span><br><span class="line">Password <span class="keyword">string</span> <span class="string">`form:&quot;password&quot;, json:&quot;password&quot;`</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">g := gin.Default()</span><br><span class="line"></span><br><span class="line"><span class="comment">// 获取url中传递的参数   列：baidu.com/search?query=go语言</span></span><br><span class="line">g.GET(<span class="string">&quot;/search&quot;</span>, <span class="function"><span class="keyword">func</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">name := c.Query(<span class="string">&quot;query&quot;</span>)</span><br><span class="line">query := c.DefaultQuery(<span class="string">&quot;query&quot;</span>, <span class="string">&quot;当没有获取到值时，则当前为默认值&quot;</span>)</span><br><span class="line"><span class="comment">// str, isNotNull := c.GetQuery(&quot;query&quot;) // 当有值时，isNotNull=true，否则为 false</span></span><br><span class="line"></span><br><span class="line">c.JSON(<span class="number">200</span>, gin.H&#123;</span><br><span class="line"><span class="string">&quot;keyWord&quot;</span>: name,</span><br><span class="line"><span class="string">&quot;默认值&quot;</span>: query,</span><br><span class="line">&#125;)</span><br><span class="line">&#125;)</span><br><span class="line">    </span><br><span class="line"><span class="comment">// 获取post方式表单提交的参数</span></span><br><span class="line">g.POST(<span class="string">&quot;/login&quot;</span>, <span class="function"><span class="keyword">func</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">user := c.PostForm(<span class="string">&quot;user&quot;</span>)</span><br><span class="line">pwd := c.PostForm(<span class="string">&quot;pwd&quot;</span>)</span><br><span class="line">code := c.DefaultPostForm(<span class="string">&quot;code&quot;</span>, <span class="string">&quot;123456&quot;</span>)</span><br><span class="line"></span><br><span class="line">c.JSON(<span class="number">200</span>, gin.H&#123;</span><br><span class="line"><span class="string">&quot;post&quot;</span>: <span class="literal">true</span>,</span><br><span class="line"><span class="string">&quot;user&quot;</span>: user,</span><br><span class="line"><span class="string">&quot;pwd&quot;</span>:  pwd,</span><br><span class="line"><span class="string">&quot;code&quot;</span>: code,</span><br><span class="line">&#125;)</span><br><span class="line">&#125;)</span><br><span class="line">    </span><br><span class="line"><span class="comment">// 获取url路径参数</span></span><br><span class="line">g.GET(<span class="string">&quot;/mysql/:root/:pwd&quot;</span>, <span class="function"><span class="keyword">func</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">root := c.Param(<span class="string">&quot;root&quot;</span>)</span><br><span class="line">pwd := c.Param(<span class="string">&quot;pwd&quot;</span>)</span><br><span class="line"></span><br><span class="line">c.JSON(<span class="number">200</span>, gin.H&#123;</span><br><span class="line"><span class="string">&quot;root&quot;</span>: root,</span><br><span class="line"><span class="string">&quot;pwd&quot;</span>:  pwd,</span><br><span class="line">&#125;)</span><br><span class="line">&#125;)</span><br><span class="line">    </span><br><span class="line"><span class="comment">// 获取数据封装为实体类</span></span><br><span class="line">g.POST(<span class="string">&quot;/register&quot;</span>, <span class="function"><span class="keyword">func</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line"><span class="keyword">var</span> u UserInfo</span><br><span class="line">err := c.ShouldBind(&amp;u)</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">fmt.Printf(<span class="string">&quot;bindfail %#v \n&quot;</span>, err)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">c.JSON(<span class="number">200</span>, gin.H&#123;</span><br><span class="line"><span class="string">&quot;root&quot;</span>: u.Username,</span><br><span class="line"><span class="string">&quot;pwd&quot;</span>:  u.Password,</span><br><span class="line">&#125;)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 文件上传</span></span><br><span class="line">g.POST(<span class="string">&quot;/upload&quot;</span>, <span class="function"><span class="keyword">func</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">file, _ := c.FormFile(<span class="string">&quot;file&quot;</span>)</span><br><span class="line"><span class="comment">//form, _ := c.MultipartForm()  上传多个文件时，使用该方法</span></span><br><span class="line"></span><br><span class="line">c.JSON(<span class="number">200</span>, <span class="string">&quot;ok&quot;</span>)</span><br><span class="line"><span class="comment">// 拼接存储路径</span></span><br><span class="line">filePath := path.Join(<span class="string">&quot;./&quot;</span>, file.Filename)</span><br><span class="line"><span class="comment">// 存储</span></span><br><span class="line">c.SaveUploadedFile(file, filePath)</span><br><span class="line">&#125;)</span><br><span class="line">    </span><br><span class="line">    g.Run(<span class="string">&quot;:8666&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="请求转发和重定向"><a href="#请求转发和重定向" class="headerlink" title="请求转发和重定向"></a>请求转发和重定向</h4><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">g := gin.Default()</span><br><span class="line"></span><br><span class="line"><span class="comment">// 请求重定向</span></span><br><span class="line">g.GET(<span class="string">&quot;/baidu&quot;</span>, <span class="function"><span class="keyword">func</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">        <span class="comment">// 重定向</span></span><br><span class="line">c.Redirect(http.StatusMovedPermanently, <span class="string">&quot;https://baidu.com&quot;</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 请求转发</span></span><br><span class="line">g.GET(<span class="string">&quot;/a&quot;</span>, <span class="function"><span class="keyword">func</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line"><span class="comment">// 改变下一条路径</span></span><br><span class="line">c.Request.URL.Path = <span class="string">&quot;/b&quot;</span></span><br><span class="line">        <span class="comment">// 注意 对象g</span></span><br><span class="line">g.HandleContext(c)</span><br><span class="line">&#125;)</span><br><span class="line">g.GET(<span class="string">&quot;/b&quot;</span>, <span class="function"><span class="keyword">func</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">c.JSON(<span class="number">200</span>, gin.H&#123;</span><br><span class="line"><span class="string">&quot;code&quot;</span>:    <span class="number">200</span>,</span><br><span class="line"><span class="string">&quot;message&quot;</span>: <span class="string">&quot;OK&quot;</span>,</span><br><span class="line">&#125;)</span><br><span class="line">&#125;)</span><br><span class="line">    </span><br><span class="line">    g.Run(<span class="string">&quot;:8666&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="返回HTML页面和模板解析"><a href="#返回HTML页面和模板解析" class="headerlink" title="返回HTML页面和模板解析"></a>返回HTML页面和模板解析</h4><div class="note blue"><p>目录结构如下</p></div><p><img src="006.png" class="lazyload placeholder" data-srcset="006.png" srcset="https://cdn.jsdelivr.net/gh/volantis-x/cdn-volantis@3/img/placeholder/c617bfd2497fcea598e621413e315c368f8d8e.svg" alt="目录结构"></p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> (</span><br><span class="line"><span class="string">&quot;github.com/gin-gonic/gin&quot;</span></span><br><span class="line"><span class="string">&quot;html/template&quot;</span></span><br><span class="line"><span class="string">&quot;net/http&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">g := gin.Default()</span><br><span class="line"></span><br><span class="line"><span class="comment">// 自定义模板解析函数</span></span><br><span class="line">g.SetFuncMap(template.FuncMap&#123;</span><br><span class="line"><span class="string">&quot;safe&quot;</span>: <span class="function"><span class="keyword">func</span><span class="params">(str <span class="keyword">string</span>)</span> <span class="title">template</span>.<span class="title">HTML</span></span>&#123;</span><br><span class="line"><span class="keyword">return</span> template.HTML(str)</span><br><span class="line">&#125;,</span><br><span class="line">&#125;)</span><br><span class="line">    <span class="comment">// 扫描并加载模板 此方法要写在 SetFuncMap()方法之下，否则会出错</span></span><br><span class="line">g.LoadHTMLGlob(<span class="string">&quot;./templates/**/*&quot;</span>)</span><br><span class="line"></span><br><span class="line">g.GET(<span class="string">&quot;/ihtml&quot;</span>, <span class="function"><span class="keyword">func</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">c.HTML(http.StatusOK, <span class="string">&quot;index/index.tmpl&quot;</span>, gin.H&#123;</span><br><span class="line"><span class="string">&quot;title&quot;</span>: <span class="string">&quot;&lt;a href=&#x27;www.baidu.com&#x27;&gt;百度&lt;/a&gt;&quot;</span>,</span><br><span class="line">&#125;)</span><br><span class="line">&#125;)</span><br><span class="line">g.GET(<span class="string">&quot;/uhtml&quot;</span>, <span class="function"><span class="keyword">func</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">c.HTML(http.StatusOK, <span class="string">&quot;user/index.tmpl&quot;</span>, gin.H&#123;</span><br><span class="line"><span class="string">&quot;title&quot;</span>: <span class="string">&quot;&lt;a href=&#x27;www.baidu.com&#x27;&gt;百度&lt;/a&gt;&quot;</span>,</span><br><span class="line">&#125;)</span><br><span class="line">&#125;)</span><br><span class="line">    </span><br><span class="line">    g.Run(<span class="string">&quot;:8666&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>define &quot;name&quot; </code>  用来定义该模板名称  </p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123; define &quot;index&#x2F;index.tmpl&quot;&#125;&#125;</span><br><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html lang&#x3D;&quot;en&quot;&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;meta charset&#x3D;&quot;UTF-8&quot;&gt;</span><br><span class="line">    &lt;title&gt;首页&lt;&#x2F;title&gt;</span><br><span class="line">&lt;&#x2F;head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">    &lt;h1&gt;Index Index ， &#123;&#123; .title &#125;&#125;&lt;&#x2F;h1&gt;</span><br><span class="line">&lt;&#x2F;body&gt;</span><br><span class="line">&lt;&#x2F;html&gt;</span><br><span class="line">&#123;&#123;end&#125;&#125;</span><br></pre></td></tr></table></figure><p><img src="004.png" class="lazyload placeholder" data-srcset="004.png" srcset="https://cdn.jsdelivr.net/gh/volantis-x/cdn-volantis@3/img/placeholder/c617bfd2497fcea598e621413e315c368f8d8e.svg" alt="ihtml"></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123; define &quot;user&#x2F;index.tmpl&quot;&#125;&#125;</span><br><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html lang&#x3D;&quot;en&quot;&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;meta charset&#x3D;&quot;UTF-8&quot;&gt;</span><br><span class="line">    &lt;title&gt;首页&lt;&#x2F;title&gt;</span><br><span class="line">&lt;&#x2F;head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">    &#123;&#123;&#x2F;* “.” 代表传入的对象名 “.属性名” 可以拿到传递过来value值 *&#x2F;&#125;&#125;</span><br><span class="line">    &#123;&#123;&#x2F;* 使用自定义模板解析函数 “ | safe”  *&#x2F;&#125;&#125;</span><br><span class="line">    &lt;h1&gt;Users Index ， &#123;&#123; .title | safe&#125;&#125;&lt;&#x2F;h1&gt;</span><br><span class="line">&lt;&#x2F;body&gt;</span><br><span class="line">&lt;&#x2F;html&gt;</span><br><span class="line">&#123;&#123;end&#125;&#125;</span><br></pre></td></tr></table></figure><p><img src="005.png" class="lazyload placeholder" data-srcset="005.png" srcset="https://cdn.jsdelivr.net/gh/volantis-x/cdn-volantis@3/img/placeholder/c617bfd2497fcea598e621413e315c368f8d8e.svg" alt="uhtml"></p><h4 id="加载静态文件"><a href="#加载静态文件" class="headerlink" title="加载静态文件"></a>加载静态文件</h4><p>在 <code>&quot;index/index.tmpl&quot;</code> 文件中引入 css文件和js文件</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">&quot;stylesheet&quot;</span> <span class="attr">href</span>=<span class="string">&quot;/static/css/index.css&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">rel</span>=<span class="string">&quot;script&quot;</span> <span class="attr">src</span>=<span class="string">&quot;/static/js/index.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><p><code>/resources/static/css/index.css</code></p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">h1</span> &#123;</span><br><span class="line">    <span class="attribute">color</span>: red;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>/resources/static/js/index.js</code></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> url = location.pathname</span><br><span class="line">alert(url)</span><br></pre></td></tr></table></figure><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 当静态资源访问路劲中有&#x27;参数1&#x27;的值时，则从&#x27;参数2&#x27;目录中找对应文件</span></span><br><span class="line">g.Static(<span class="string">&quot;/static/css&quot;</span>, <span class="string">&quot;./resources/statics/css&quot;</span>)</span><br><span class="line">g.Static(<span class="string">&quot;/static/js&quot;</span>, <span class="string">&quot;./resources/statics/js&quot;</span>)</span><br><span class="line">g.StaticFile(<span class="string">&quot;/favicon.ico&quot;</span>, <span class="string">&quot;./resources/favicon.ico&quot;</span>)</span><br></pre></td></tr></table></figure><p><img src="007.png" class="lazyload placeholder" data-srcset="007.png" srcset="https://cdn.jsdelivr.net/gh/volantis-x/cdn-volantis@3/img/placeholder/c617bfd2497fcea598e621413e315c368f8d8e.svg" alt="ihtml"></p><p>后续……</p>]]></content>
      
      
      <categories>
          
          <category> golang </category>
          
          <category> gin </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Go </tag>
            
            <tag> Gin </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Maven的下载安装与配置</title>
      <link href="2020/07/09/Maven%E7%9A%84%E4%B8%8B%E8%BD%BD%E5%AE%89%E8%A3%85%E4%B8%8E%E9%85%8D%E7%BD%AE/"/>
      <url>2020/07/09/Maven%E7%9A%84%E4%B8%8B%E8%BD%BD%E5%AE%89%E8%A3%85%E4%B8%8E%E9%85%8D%E7%BD%AE/</url>
      
        <content type="html"><![CDATA[<p>Maven的下载安装、配置及简单使用</p><a id="more"></a><h2 id="Maven简介"><a href="#Maven简介" class="headerlink" title="Maven简介"></a>Maven简介</h2><p><a href="http://maven.apache.org/">Apache Maven</a>是一个软件项目管理和理解工具。基于项目对象模型（POM）的概念，Maven可以从中央信息管理项目的构建，报告和文档。</p><h2 id="Maven下载"><a href="#Maven下载" class="headerlink" title="Maven下载"></a>Maven下载</h2><p>点击 Download进行下载</p><p><img src="image-20200710071945001.png" class="lazyload placeholder" data-srcset="image-20200710071945001.png" srcset="https://cdn.jsdelivr.net/gh/volantis-x/cdn-volantis@3/img/placeholder/c617bfd2497fcea598e621413e315c368f8d8e.svg" alt="image-20200710071945001"></p><p>选择二进制下载，版本为3.6.3</p><p><img src="image-20200710072517903.png" class="lazyload placeholder" data-srcset="image-20200710072517903.png" srcset="https://cdn.jsdelivr.net/gh/volantis-x/cdn-volantis@3/img/placeholder/c617bfd2497fcea598e621413e315c368f8d8e.svg" alt="image-20200710072517903"></p><h2 id="Maven安装"><a href="#Maven安装" class="headerlink" title="Maven安装"></a>Maven安装</h2><ol><li>解压缩之后目录</li></ol><p><img src="image-20200710072759020.png" class="lazyload placeholder" data-srcset="image-20200710072759020.png" srcset="https://cdn.jsdelivr.net/gh/volantis-x/cdn-volantis@3/img/placeholder/c617bfd2497fcea598e621413e315c368f8d8e.svg" alt="image-20200710072759020"></p><ol start="2"><li>配置系统环境变量</li></ol><div class="note blue"><p>此电脑-&gt;属性-&gt;高级系统设置-&gt;环境变量-&gt;系统变量-&gt;新建</p></div><p><img src="image-20200710075033703.png" class="lazyload placeholder" data-srcset="image-20200710075033703.png" srcset="https://cdn.jsdelivr.net/gh/volantis-x/cdn-volantis@3/img/placeholder/c617bfd2497fcea598e621413e315c368f8d8e.svg" alt="image-20200710075033703"></p><p>在path 环境变量后添加 %MAVEN_HOME%/bin</p><p><img src="image-20200710075157968.png" class="lazyload placeholder" data-srcset="image-20200710075157968.png" srcset="https://cdn.jsdelivr.net/gh/volantis-x/cdn-volantis@3/img/placeholder/c617bfd2497fcea598e621413e315c368f8d8e.svg" alt="image-20200710075157968"></p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查看Maven是否安装成功，使用命令</span></span><br><span class="line">mvn <span class="literal">-version</span></span><br></pre></td></tr></table></figure><h2 id="配置本地仓库"><a href="#配置本地仓库" class="headerlink" title="配置本地仓库"></a>配置本地仓库</h2><p>首先，我们要知道什么是仓库，详情可参考<a href="https://www.runoob.com/maven/maven-repositories.html">菜鸟教程</a></p><p>简单来说，就是“我”安装了一个软件叫Maven，当”我“输入一个jar包的名字，让Maven这个软件去帮我下载，从而不用自己再去Maven仓库手动下载。</p><p>但是，Maven默认是去中央仓库下载jar包，而中央仓库又是在国外，访问会很慢，所以配置一个本地仓库，将远程仓库的jar包下载并保存到本地，这样当下次再使用时就不用到国外去下载了，速度飕飕的。</p><hr><p>在Maven根目录中打开conf/settings.xml，配置 localRepository，写自己<strong>创建的</strong>文件路径即可</p><p><img src="image-20200710081404327.png" class="lazyload placeholder" data-srcset="image-20200710081404327.png" srcset="https://cdn.jsdelivr.net/gh/volantis-x/cdn-volantis@3/img/placeholder/c617bfd2497fcea598e621413e315c368f8d8e.svg" alt="image-20200710081404327"></p><h2 id="配置阿里云镜像加速"><a href="#配置阿里云镜像加速" class="headerlink" title="配置阿里云镜像加速"></a>配置阿里云镜像加速</h2><p>即使配置了本地仓库，第一次去国外下载依旧很慢，我们可以配置为阿里云仓库</p><p>打开Maven根目录中的conf/settings.xml文件，在 mirrors 节点上，添加内容如下：</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">mirrors</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mirror</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">id</span>&gt;</span>alimaven<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">mirrorOf</span>&gt;</span>central<span class="tag">&lt;/<span class="name">mirrorOf</span>&gt;</span>        </span><br><span class="line">      <span class="tag">&lt;<span class="name">name</span>&gt;</span>aliyun maven<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">url</span>&gt;</span>http://maven.aliyun.com/nexus/content/groups/public/<span class="tag">&lt;/<span class="name">url</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">mirror</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mirrors</span>&gt;</span></span><br></pre></td></tr></table></figure><p><img src="image-20200710082403929.png" class="lazyload placeholder" data-srcset="image-20200710082403929.png" srcset="https://cdn.jsdelivr.net/gh/volantis-x/cdn-volantis@3/img/placeholder/c617bfd2497fcea598e621413e315c368f8d8e.svg" alt="image-20200710082403929"></p><h2 id="IntelliJ-IDEA配置Maven"><a href="#IntelliJ-IDEA配置Maven" class="headerlink" title="IntelliJ IDEA配置Maven"></a>IntelliJ IDEA配置Maven</h2><div class="note "><p>打开IntelliJ IDEA，选择 file&gt;settings&gt;Build,Execution,Deployment&gt;Build Tools&gt;Maven</p></div><p><img src="image-20200710090945844.png" class="lazyload placeholder" data-srcset="image-20200710090945844.png" srcset="https://cdn.jsdelivr.net/gh/volantis-x/cdn-volantis@3/img/placeholder/c617bfd2497fcea598e621413e315c368f8d8e.svg" alt="image-20200710090945844"></p><h3 id="创建Maven项目"><a href="#创建Maven项目" class="headerlink" title="创建Maven项目"></a>创建Maven项目</h3><div class="note "><p>新建Maven项目 file&gt;New&gt;Project</p></div><p><img src="image-20200710092901042.png" class="lazyload placeholder" data-srcset="image-20200710092901042.png" srcset="https://cdn.jsdelivr.net/gh/volantis-x/cdn-volantis@3/img/placeholder/c617bfd2497fcea598e621413e315c368f8d8e.svg" alt="image-20200710092901042"></p><div class="note idea"><p>设置 GroupId、Artifactld、Version <br> ​ GroupId: 组织名，公司网址的反写 + 项目名称 <br> ​ ArtifactId: 项目名-模块名 <br> ​ Version: 项目版本 <br></p></div><p><img src="image-20200710093225989.png" class="lazyload placeholder" data-srcset="image-20200710093225989.png" srcset="https://cdn.jsdelivr.net/gh/volantis-x/cdn-volantis@3/img/placeholder/c617bfd2497fcea598e621413e315c368f8d8e.svg" alt="image-20200710093225989"></p><p>选择安装位置，点击Finish完成构建</p><p><img src="image-20200710095258259.png" class="lazyload placeholder" data-srcset="image-20200710095258259.png" srcset="https://cdn.jsdelivr.net/gh/volantis-x/cdn-volantis@3/img/placeholder/c617bfd2497fcea598e621413e315c368f8d8e.svg" alt="image-20200710095258259"></p><h3 id="Maven目录结构"><a href="#Maven目录结构" class="headerlink" title="Maven目录结构"></a>Maven目录结构</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">src</span><br><span class="line">  -main</span><br><span class="line">      -java java源代码文件</span><br><span class="line">      -resources 资源库，会自动复制到classes目录里   </span><br><span class="line">      -webapp web应用的目录。WEB-INF、css、js等 </span><br><span class="line">  - test</span><br><span class="line">      -java 单元测试java源代码文件</span><br><span class="line">      -resources 测试需要用的资源库</span><br><span class="line">target</span><br><span class="line">  - classes 项目主体输出目录</span><br><span class="line">  - test-classes 项目测试输出目录</span><br><span class="line">pom.xml  maven的pom文件,再此处添加jar依赖</span><br><span class="line">LICENSE.txt Project’s license</span><br><span class="line">README.txt Project’s readme</span><br></pre></td></tr></table></figure><h3 id="测试"><a href="#测试" class="headerlink" title="测试"></a>测试</h3><p>在pom.xml中添加Spring依赖：</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-context<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.2.5.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure><div class="note "><p>在/src/main/java下创建Person类</p></div><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Person</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> Integer age;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// getter、setter 省略</span></span><br></pre></td></tr></table></figure><div class="note "><p>在/src/main/resourse下创建 applicationContext.xml</p></div><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/beans </span></span></span><br><span class="line"><span class="tag"><span class="string">       http://www.springframework.org/schema/beans/spring-beans.xsd&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;dateFormat&quot;</span> <span class="attr">class</span>=<span class="string">&quot;java.text.SimpleDateFormat&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">value</span>=<span class="string">&quot;yyyy-MM-dd &quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;yuxiang&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.yuxiang.Person&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;name&quot;</span> <span class="attr">value</span>=<span class="string">&quot;雨巷&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;age&quot;</span> <span class="attr">value</span>=<span class="string">&quot;20&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure><p>创建程序入口类</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ApplicationMain</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        ClassPathXmlApplicationContext context</span><br><span class="line">                = <span class="keyword">new</span> ClassPathXmlApplicationContext(<span class="string">&quot;applicationContext.xml&quot;</span>);</span><br><span class="line">        Person yuxiang = (Person) context.getBean(<span class="string">&quot;yuxiang&quot;</span>);</span><br><span class="line">        System.out.println(yuxiang);</span><br><span class="line">        <span class="comment">// 运行结果的 Person&#123;name=&#x27;雨巷&#x27;, age=20&#125;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>项目结构图</p><p><img src="image-20200710102850593.png" class="lazyload placeholder" data-srcset="image-20200710102850593.png" srcset="https://cdn.jsdelivr.net/gh/volantis-x/cdn-volantis@3/img/placeholder/c617bfd2497fcea598e621413e315c368f8d8e.svg" alt="image-20200710102850593"></p><h2 id="eclipse配置Maven"><a href="#eclipse配置Maven" class="headerlink" title="eclipse配置Maven"></a>eclipse配置Maven</h2>]]></content>
      
      
      <categories>
          
          <category> 项目构建 </category>
          
          <category> Maven </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Maven </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
